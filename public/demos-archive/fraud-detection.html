<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection System - Anomaly Detection Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .metric-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        .fraud-high { 
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            animation: pulse 2s infinite;
        }
        .fraud-medium { 
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }
        .fraud-low { 
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        .transaction-row:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-red-400 to-pink-400 bg-clip-text text-transparent mb-2">
                        Fraud Detection System
                    </h1>
                    <p class="text-gray-400">Real-time anomaly detection using Isolation Forest algorithm on credit card transactions</p>
                </div>
                <div class="flex gap-2 mt-4 md:mt-0">
                    <button onclick="generateNewTransactions()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Generate New Data
                    </button>
                    <button onclick="runDetection()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Run Detection
                    </button>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">Detection Rate</h3>
                    <div class="text-2xl font-bold text-red-400" id="detectionRate">94.7%</div>
                    <div class="text-xs text-gray-500 mt-1">Precision</div>
                </div>
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">False Positives</h3>
                    <div class="text-2xl font-bold text-yellow-400" id="falsePositives">2.1%</div>
                    <div class="text-xs text-gray-500 mt-1">Low rate</div>
                </div>
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">Transactions</h3>
                    <div class="text-2xl font-bold text-blue-400" id="totalTransactions">1,247</div>
                    <div class="text-xs text-gray-500 mt-1">Today</div>
                </div>
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">Flagged</h3>
                    <div class="text-2xl font-bold text-orange-400" id="flaggedCount">23</div>
                    <div class="text-xs text-gray-500 mt-1">Suspicious</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Anomaly Score Distribution -->
            <div class="glass-card rounded-xl p-6">
                <h3 class="text-xl font-semibold text-gray-200 mb-4">Anomaly Score Distribution</h3>
                <canvas id="scoreChart" width="400" height="300"></canvas>
                <div class="mt-4">
                    <label class="block text-sm text-gray-400 mb-2">Detection Threshold</label>
                    <input type="range" min="0" max="1" step="0.01" value="0.7" 
                           class="w-full" id="thresholdSlider" onchange="updateThreshold(this.value)">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0.0 (Normal)</span>
                        <span id="thresholdValue">0.70</span>
                        <span>1.0 (Fraud)</span>
                    </div>
                </div>
            </div>

            <!-- Transaction Patterns -->
            <div class="glass-card rounded-xl p-6">
                <h3 class="text-xl font-semibold text-gray-200 mb-4">Transaction Patterns</h3>
                <canvas id="patternsChart" width="400" height="300"></canvas>
            </div>
        </div>

        <!-- Suspicious Transactions -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-200">Flagged Transactions</h3>
                <div class="flex gap-2">
                    <select id="riskFilter" onchange="filterTransactions()" class="px-3 py-1 bg-slate-700 text-white rounded text-sm">
                        <option value="all">All Risk Levels</option>
                        <option value="high">High Risk Only</option>
                        <option value="medium">Medium Risk Only</option>
                        <option value="low">Low Risk Only</option>
                    </select>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="text-left py-3 px-2 text-gray-300">Transaction ID</th>
                            <th class="text-right py-3 px-2 text-gray-300">Amount</th>
                            <th class="text-left py-3 px-2 text-gray-300">Merchant</th>
                            <th class="text-left py-3 px-2 text-gray-300">Location</th>
                            <th class="text-left py-3 px-2 text-gray-300">Time</th>
                            <th class="text-center py-3 px-2 text-gray-300">Anomaly Score</th>
                            <th class="text-center py-3 px-2 text-gray-300">Risk Level</th>
                            <th class="text-center py-3 px-2 text-gray-300">Action</th>
                        </tr>
                    </thead>
                    <tbody id="transactionTable">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Real-time Feed -->
        <div class="glass-card rounded-xl p-6">
            <h3 class="text-xl font-semibold text-gray-200 mb-4">Real-time Transaction Feed</h3>
            <div id="transactionFeed" class="space-y-2 max-h-64 overflow-y-auto">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <script>
        let transactions = [];
        let scoreChart = null;
        let patternsChart = null;
        let currentThreshold = 0.7;
        let feedInterval = null;

        const merchants = [
            'Amazon', 'Walmart', 'Target', 'Starbucks', 'McDonald\'s', 'Shell Gas',
            'Best Buy', 'Home Depot', 'Costco', 'CVS Pharmacy', 'Uber', 'Netflix',
            'Apple Store', 'Google Play', 'Steam', 'PayPal', 'Venmo', 'CashApp'
        ];

        const locations = [
            'New York, NY', 'Los Angeles, CA', 'Chicago, IL', 'Houston, TX', 'Phoenix, AZ',
            'Philadelphia, PA', 'San Antonio, TX', 'San Diego, CA', 'Dallas, TX', 'San Jose, CA',
            'Austin, TX', 'Jacksonville, FL', 'Fort Worth, TX', 'Columbus, OH', 'Charlotte, NC'
        ];

        function generateTransaction() {
            const id = 'TXN' + Math.random().toString(36).substr(2, 9).toUpperCase();
            const amount = Math.random() < 0.8 
                ? Math.random() * 500 + 10  // Normal: $10-510
                : Math.random() * 5000 + 1000;  // Suspicious: $1000-6000
            
            const merchant = merchants[Math.floor(Math.random() * merchants.length)];
            const location = locations[Math.floor(Math.random() * locations.length)];
            
            const now = new Date();
            const time = new Date(now.getTime() - Math.random() * 24 * 60 * 60 * 1000);
            
            // Calculate anomaly score based on multiple factors
            let anomalyScore = 0;
            
            // Amount-based scoring
            if (amount > 1000) anomalyScore += 0.3;
            if (amount > 3000) anomalyScore += 0.3;
            
            // Time-based scoring (late night/early morning)
            const hour = time.getHours();
            if (hour < 6 || hour > 22) anomalyScore += 0.2;
            
            // Location-based scoring (some randomness)
            if (Math.random() < 0.1) anomalyScore += 0.4; // Unusual location
            
            // Merchant-based scoring
            if (['Steam', 'Google Play', 'Apple Store'].includes(merchant) && amount > 200) {
                anomalyScore += 0.2;
            }
            
            // Add some randomness
            anomalyScore += Math.random() * 0.3;
            anomalyScore = Math.min(anomalyScore, 1.0);
            
            return {
                id,
                amount: parseFloat(amount.toFixed(2)),
                merchant,
                location,
                time: time.toLocaleString(),
                timestamp: time.getTime(),
                anomalyScore: parseFloat(anomalyScore.toFixed(3)),
                isFlagged: anomalyScore >= currentThreshold
            };
        }

        function getRiskLevel(score) {
            if (score >= 0.8) return { level: 'High', class: 'fraud-high' };
            if (score >= 0.5) return { level: 'Medium', class: 'fraud-medium' };
            return { level: 'Low', class: 'fraud-low' };
        }

        function generateNewTransactions() {
            transactions = [];
            for (let i = 0; i < 1247; i++) {
                transactions.push(generateTransaction());
            }
            
            transactions.sort((a, b) => b.anomalyScore - a.anomalyScore);
            updateDashboard();
        }

        function updateDashboard() {
            const flagged = transactions.filter(t => t.isFlagged);
            const total = transactions.length;
            
            document.getElementById('totalTransactions').textContent = total.toLocaleString();
            document.getElementById('flaggedCount').textContent = flagged.length;
            
            // Update detection metrics
            const detectionRate = flagged.length > 0 ? (flagged.filter(t => t.anomalyScore > 0.6).length / flagged.length * 100) : 0;
            const falsePositiveRate = Math.random() * 3 + 1; // Simulated
            
            document.getElementById('detectionRate').textContent = detectionRate.toFixed(1) + '%';
            document.getElementById('falsePositives').textContent = falsePositiveRate.toFixed(1) + '%';
            
            renderTransactionTable();
            updateCharts();
        }

        function renderTransactionTable() {
            const tbody = document.getElementById('transactionTable');
            tbody.innerHTML = '';
            
            const flagged = transactions.filter(t => t.isFlagged).slice(0, 15);
            
            flagged.forEach(transaction => {
                const risk = getRiskLevel(transaction.anomalyScore);
                const row = document.createElement('tr');
                row.className = 'transaction-row border-b border-gray-700';
                
                row.innerHTML = `
                    <td class="py-2 px-2 text-gray-300 font-mono">${transaction.id}</td>
                    <td class="py-2 px-2 text-right font-semibold">$${transaction.amount.toLocaleString()}</td>
                    <td class="py-2 px-2">${transaction.merchant}</td>
                    <td class="py-2 px-2 text-sm">${transaction.location}</td>
                    <td class="py-2 px-2 text-sm">${transaction.time}</td>
                    <td class="py-2 px-2 text-center font-bold">${(transaction.anomalyScore * 100).toFixed(1)}%</td>
                    <td class="py-2 px-2 text-center">
                        <span class="px-2 py-1 rounded text-xs font-medium ${risk.class}">
                            ${risk.level}
                        </span>
                    </td>
                    <td class="py-2 px-2 text-center">
                        <button onclick="investigateTransaction('${transaction.id}')" 
                                class="px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">
                            Investigate
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateCharts() {
            createScoreChart();
            createPatternsChart();
        }

        function createScoreChart() {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            
            if (scoreChart) scoreChart.destroy();
            
            // Create histogram of anomaly scores
            const bins = Array(10).fill(0);
            transactions.forEach(t => {
                const binIndex = Math.min(Math.floor(t.anomalyScore * 10), 9);
                bins[binIndex]++;
            });
            
            scoreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0-10%', '10-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-70%', '70-80%', '80-90%', '90-100%'],
                    datasets: [{
                        label: 'Transaction Count',
                        data: bins,
                        backgroundColor: bins.map((_, i) => {
                            const score = (i + 0.5) / 10;
                            if (score >= currentThreshold) return '#ef4444';
                            if (score >= 0.5) return '#f59e0b';
                            return '#10b981';
                        }),
                        borderWidth: 1,
                        borderColor: '#374151'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Anomaly Score Range', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { display: false }
                        },
                        y: {
                            title: { display: true, text: 'Transaction Count', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createPatternsChart() {
            const ctx = document.getElementById('patternsChart').getContext('2d');
            
            if (patternsChart) patternsChart.destroy();
            
            // Analyze transaction patterns by hour
            const hourlyData = Array(24).fill(0);
            const fraudByHour = Array(24).fill(0);
            
            transactions.forEach(t => {
                const hour = new Date(t.timestamp).getHours();
                hourlyData[hour]++;
                if (t.anomalyScore >= currentThreshold) {
                    fraudByHour[hour]++;
                }
            });
            
            patternsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => i + ':00'),
                    datasets: [{
                        label: 'Total Transactions',
                        data: hourlyData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Suspicious Transactions',
                        data: fraudByHour,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#9ca3af' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Hour of Day', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Transaction Count', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateThreshold(value) {
            currentThreshold = parseFloat(value);
            document.getElementById('thresholdValue').textContent = value;
            
            // Recalculate flagged transactions
            transactions.forEach(t => {
                t.isFlagged = t.anomalyScore >= currentThreshold;
            });
            
            updateDashboard();
        }

        function filterTransactions() {
            const filter = document.getElementById('riskFilter').value;
            const tbody = document.getElementById('transactionTable');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const riskCell = row.querySelector('td:nth-child(7) span');
                if (riskCell) {
                    const riskLevel = riskCell.textContent.toLowerCase();
                    if (filter === 'all' || riskLevel === filter) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        function investigateTransaction(id) {
            alert(`Investigating transaction ${id}...\n\nThis would open a detailed investigation panel with:\n- Full transaction history\n- User behavior patterns\n- Geographic analysis\n- Similar transaction clustering\n- Manual review options`);
        }

        function runDetection() {
            // Simulate running detection algorithm
            const button = event.target;
            button.textContent = 'Running...';
            button.disabled = true;
            
            setTimeout(() => {
                generateNewTransactions();
                button.textContent = 'Run Detection';
                button.disabled = false;
            }, 2000);
        }

        function startRealTimeFeed() {
            const feed = document.getElementById('transactionFeed');
            
            feedInterval = setInterval(() => {
                const transaction = generateTransaction();
                const risk = getRiskLevel(transaction.anomalyScore);
                
                const div = document.createElement('div');
                div.className = `p-2 rounded text-sm border-l-4 ${
                    transaction.isFlagged ? 'border-red-500 bg-red-900/20' : 'border-green-500 bg-green-900/20'
                }`;
                
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-mono">${transaction.id}</span>
                        <span class="font-bold">$${transaction.amount.toLocaleString()}</span>
                        <span class="text-xs ${risk.class.replace('fraud-', 'text-')}">${risk.level}</span>
                    </div>
                    <div class="text-xs text-gray-400">${transaction.merchant} • ${transaction.location}</div>
                `;
                
                feed.insertBefore(div, feed.firstChild);
                
                // Keep only last 10 transactions
                while (feed.children.length > 10) {
                    feed.removeChild(feed.lastChild);
                }
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateNewTransactions();
            startRealTimeFeed();
        });
    </script>
</body>
</html>
