<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictive Healthcare Outcomes - Heart Disease Risk Prediction</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        .metric-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .risk-low { color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .risk-medium { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .risk-high { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .feature-bar {
            transition: width 0.3s ease;
            background: linear-gradient(90deg, #10b981, #059669);
        }
        .patient-row:hover {
            background: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent mb-2">
                        Predictive Healthcare Outcomes
                    </h1>
                    <p class="text-gray-400">Machine Learning model for heart disease risk prediction using patient health metrics</p>
                </div>
                <div class="flex gap-2 mt-4 md:mt-0">
                    <button onclick="generateNewData()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        Generate New Patients
                    </button>
                    <button onclick="retrain()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Retrain Model
                    </button>
                </div>
            </div>

            <!-- Model Performance Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">Model Accuracy</h3>
                    <div class="text-2xl font-bold text-green-400" id="accuracy">89.2%</div>
                    <div class="text-xs text-gray-500 mt-1">Cross-validated</div>
                </div>
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">Precision</h3>
                    <div class="text-2xl font-bold text-blue-400" id="precision">91.4%</div>
                    <div class="text-xs text-gray-500 mt-1">True positives</div>
                </div>
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">Recall</h3>
                    <div class="text-2xl font-bold text-purple-400" id="recall">86.8%</div>
                    <div class="text-xs text-gray-500 mt-1">Sensitivity</div>
                </div>
                <div class="metric-card rounded-lg p-4 text-center">
                    <h3 class="text-sm text-gray-400 mb-1">AUC-ROC</h3>
                    <div class="text-2xl font-bold text-orange-400" id="auc">0.924</div>
                    <div class="text-xs text-gray-500 mt-1">Excellent</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Feature Importance -->
            <div class="glass-card rounded-xl p-6">
                <h3 class="text-xl font-semibold text-gray-200 mb-4">Feature Importance</h3>
                <div class="space-y-4">
                    <div class="feature-item">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">Cholesterol Level</span>
                            <span class="text-sm text-green-400" id="feat-chol">34.2%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="feature-bar h-2 rounded-full" style="width: 34.2%"></div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">Age</span>
                            <span class="text-sm text-green-400" id="feat-age">28.7%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="feature-bar h-2 rounded-full" style="width: 28.7%"></div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">Blood Pressure</span>
                            <span class="text-sm text-green-400" id="feat-bp">19.3%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="feature-bar h-2 rounded-full" style="width: 19.3%"></div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">BMI</span>
                            <span class="text-sm text-green-400" id="feat-bmi">12.1%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="feature-bar h-2 rounded-full" style="width: 12.1%"></div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">Smoking Status</span>
                            <span class="text-sm text-green-400" id="feat-smoke">3.8%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="feature-bar h-2 rounded-full" style="width: 3.8%"></div>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">Exercise Frequency</span>
                            <span class="text-sm text-green-400" id="feat-exercise">1.9%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="feature-bar h-2 rounded-full" style="width: 1.9%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ROC Curve -->
            <div class="glass-card rounded-xl p-6">
                <h3 class="text-xl font-semibold text-gray-200 mb-4">ROC Curve Analysis</h3>
                <canvas id="rocChart" width="400" height="300"></canvas>
                <div class="mt-4 flex justify-between text-sm">
                    <div>
                        <span class="text-gray-400">Threshold: </span>
                        <span class="text-green-400" id="threshold">0.50</span>
                    </div>
                    <div>
                        <span class="text-gray-400">Current AUC: </span>
                        <span class="text-green-400">0.924</span>
                    </div>
                </div>
                <input type="range" min="0" max="1" step="0.01" value="0.5" 
                       class="w-full mt-2" id="thresholdSlider" onchange="updateThreshold(this.value)">
            </div>
        </div>

        <!-- Patient Risk Assessment -->
        <div class="glass-card rounded-xl p-6 mb-6">
            <h3 class="text-xl font-semibold text-gray-200 mb-4">Patient Risk Assessment (Sample of 500 patients)</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="text-left py-3 px-2 text-gray-300">Patient ID</th>
                            <th class="text-right py-3 px-2 text-gray-300">Age</th>
                            <th class="text-right py-3 px-2 text-gray-300">BMI</th>
                            <th class="text-right py-3 px-2 text-gray-300">Cholesterol</th>
                            <th class="text-right py-3 px-2 text-gray-300">BP (Sys)</th>
                            <th class="text-center py-3 px-2 text-gray-300">Smoker</th>
                            <th class="text-right py-3 px-2 text-gray-300">Exercise/Week</th>
                            <th class="text-center py-3 px-2 text-gray-300">Risk Score</th>
                            <th class="text-center py-3 px-2 text-gray-300">Risk Level</th>
                        </tr>
                    </thead>
                    <tbody id="patientTable">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Risk Distribution -->
        <div class="glass-card rounded-xl p-6">
            <h3 class="text-xl font-semibold text-gray-200 mb-4">Risk Distribution</h3>
            <canvas id="distributionChart" width="400" height="200"></canvas>
        </div>
    </div>

    <script>
        let patients = [];
        let model = null;
        let rocChart = null;
        let distributionChart = null;

        // Generate synthetic patient data
        function generatePatientData(count = 500) {
            const data = [];
            for (let i = 0; i < count; i++) {
                const age = Math.floor(Math.random() * 50) + 30; // 30-80
                const bmi = Math.random() * 15 + 20; // 20-35
                const cholesterol = Math.random() * 150 + 150; // 150-300
                const systolicBP = Math.random() * 60 + 110; // 110-170
                const smoker = Math.random() < 0.3 ? 1 : 0;
                const exerciseFreq = Math.floor(Math.random() * 8); // 0-7 days per week
                
                // Calculate risk based on realistic medical factors
                let riskScore = 0;
                riskScore += (age - 30) / 50 * 0.3;
                riskScore += (bmi - 20) / 15 * 0.15;
                riskScore += (cholesterol - 150) / 150 * 0.35;
                riskScore += (systolicBP - 110) / 60 * 0.2;
                riskScore += smoker * 0.25;
                riskScore -= exerciseFreq / 7 * 0.1;
                
                // Add some randomness
                riskScore += (Math.random() - 0.5) * 0.2;
                riskScore = Math.max(0, Math.min(1, riskScore));
                
                const hasHeartDisease = riskScore > 0.5 ? 1 : 0;
                
                data.push({
                    id: `P${String(i + 1).padStart(3, '0')}`,
                    age: Math.round(age),
                    bmi: parseFloat(bmi.toFixed(1)),
                    cholesterol: Math.round(cholesterol),
                    systolicBP: Math.round(systolicBP),
                    smoker,
                    exerciseFreq,
                    riskScore: parseFloat(riskScore.toFixed(3)),
                    hasHeartDisease
                });
            }
            return data;
        }

        function getRiskLevel(score) {
            if (score < 0.3) return { level: 'Low', class: 'risk-low' };
            if (score < 0.7) return { level: 'Medium', class: 'risk-medium' };
            return { level: 'High', class: 'risk-high' };
        }

        function renderPatientTable() {
            const tbody = document.getElementById('patientTable');
            tbody.innerHTML = '';
            
            // Show first 10 patients
            patients.slice(0, 10).forEach(patient => {
                const risk = getRiskLevel(patient.riskScore);
                const row = document.createElement('tr');
                row.className = 'patient-row border-b border-gray-700';
                
                row.innerHTML = `
                    <td class="py-2 px-2 text-gray-300">${patient.id}</td>
                    <td class="py-2 px-2 text-right">${patient.age}</td>
                    <td class="py-2 px-2 text-right">${patient.bmi}</td>
                    <td class="py-2 px-2 text-right">${patient.cholesterol}</td>
                    <td class="py-2 px-2 text-right">${patient.systolicBP}</td>
                    <td class="py-2 px-2 text-center">${patient.smoker ? 'Yes' : 'No'}</td>
                    <td class="py-2 px-2 text-right">${patient.exerciseFreq}</td>
                    <td class="py-2 px-2 text-center font-semibold">${(patient.riskScore * 100).toFixed(1)}%</td>
                    <td class="py-2 px-2 text-center">
                        <span class="px-2 py-1 rounded text-xs font-medium ${risk.class}">
                            ${risk.level}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function createROCChart() {
            const ctx = document.getElementById('rocChart').getContext('2d');
            
            // Generate ROC curve points
            const rocPoints = [];
            for (let i = 0; i <= 100; i++) {
                const threshold = i / 100;
                let tp = 0, fp = 0, tn = 0, fn = 0;
                
                patients.forEach(patient => {
                    const predicted = patient.riskScore >= threshold ? 1 : 0;
                    const actual = patient.hasHeartDisease;
                    
                    if (predicted === 1 && actual === 1) tp++;
                    else if (predicted === 1 && actual === 0) fp++;
                    else if (predicted === 0 && actual === 0) tn++;
                    else if (predicted === 0 && actual === 1) fn++;
                });
                
                const tpr = tp / (tp + fn) || 0; // True Positive Rate
                const fpr = fp / (fp + tn) || 0; // False Positive Rate
                
                rocPoints.push({ x: fpr, y: tpr });
            }
            
            rocChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'ROC Curve',
                        data: rocPoints,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }, {
                        label: 'Random Classifier',
                        data: [{ x: 0, y: 0 }, { x: 1, y: 1 }],
                        borderColor: '#6b7280',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#9ca3af' }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'False Positive Rate', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'True Positive Rate', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' }
                        }
                    }
                }
            });
        }

        function createDistributionChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            // Create risk score histogram
            const bins = Array(10).fill(0);
            patients.forEach(patient => {
                const binIndex = Math.min(Math.floor(patient.riskScore * 10), 9);
                bins[binIndex]++;
            });
            
            distributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0-10%', '10-20%', '20-30%', '30-40%', '40-50%', '50-60%', '60-70%', '70-80%', '80-90%', '90-100%'],
                    datasets: [{
                        label: 'Number of Patients',
                        data: bins,
                        backgroundColor: [
                            '#10b981', '#10b981', '#10b981', // Low risk (green)
                            '#f59e0b', '#f59e0b', '#f59e0b', '#f59e0b', // Medium risk (yellow)
                            '#ef4444', '#ef4444', '#ef4444' // High risk (red)
                        ],
                        borderWidth: 1,
                        borderColor: '#374151'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Risk Score Range', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { display: false }
                        },
                        y: {
                            title: { display: true, text: 'Patient Count', color: '#9ca3af' },
                            ticks: { color: '#9ca3af' },
                            grid: { color: 'rgba(156, 163, 175, 0.1)' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateThreshold(value) {
            document.getElementById('threshold').textContent = parseFloat(value).toFixed(2);
            
            // Recalculate metrics with new threshold
            let tp = 0, fp = 0, tn = 0, fn = 0;
            
            patients.forEach(patient => {
                const predicted = patient.riskScore >= value ? 1 : 0;
                const actual = patient.hasHeartDisease;
                
                if (predicted === 1 && actual === 1) tp++;
                else if (predicted === 1 && actual === 0) fp++;
                else if (predicted === 0 && actual === 0) tn++;
                else if (predicted === 0 && actual === 1) fn++;
            });
            
            const precision = tp / (tp + fp) || 0;
            const recall = tp / (tp + fn) || 0;
            const accuracy = (tp + tn) / (tp + fp + tn + fn) || 0;
            
            document.getElementById('precision').textContent = (precision * 100).toFixed(1) + '%';
            document.getElementById('recall').textContent = (recall * 100).toFixed(1) + '%';
            document.getElementById('accuracy').textContent = (accuracy * 100).toFixed(1) + '%';
        }

        function generateNewData() {
            patients = generatePatientData(500);
            renderPatientTable();
            
            if (distributionChart) distributionChart.destroy();
            createDistributionChart();
            
            if (rocChart) rocChart.destroy();
            createROCChart();
        }

        function retrain() {
            // Simulate model retraining with slight variations
            const baseAccuracy = 89.2;
            const basePrecision = 91.4;
            const baseRecall = 86.8;
            const baseAUC = 0.924;
            
            const variation = (Math.random() - 0.5) * 4; // ±2% variation
            
            document.getElementById('accuracy').textContent = (baseAccuracy + variation).toFixed(1) + '%';
            document.getElementById('precision').textContent = (basePrecision + variation * 0.8).toFixed(1) + '%';
            document.getElementById('recall').textContent = (baseRecall + variation * 1.2).toFixed(1) + '%';
            document.getElementById('auc').textContent = (baseAUC + variation * 0.01).toFixed(3);
            
            // Regenerate data and charts
            generateNewData();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateNewData();
        });
    </script>
</body>
</html>
