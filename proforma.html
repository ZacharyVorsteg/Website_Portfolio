<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor Pro Forma | Zachary Vorsteg</title>
    <meta name="description" content="Free real estate investment pro forma analysis tool with complete operating statement, leasing costs, and cash flow analysis.">
    <link rel="canonical" href="https://zacharyvorsteg.com/proforma.html">
    <link rel="stylesheet" href="proforma-styles.css">
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(180deg, #FEFDFB 0%, #F8FAFC 100%); }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        .input-field { background: #FFFFFF !important; border: 1px solid #E2E8F0; box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: all 0.2s; }
        .input-field:focus { border-color: #5B8A5B; box-shadow: 0 0 0 3px rgba(91,138,91,0.15); outline: none; }
        .sticky-col { position: sticky; left: 0; z-index: 10; }
        @media print { .no-print { display: none !important; } body { background: white; } }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #F1F5F9; }
        .section-header { background: #F8FAFC; font-weight: 600; color: #334155; border-bottom: 2px solid #E2E8F0; }
        .subtotal-row { background: #F1F5F9; font-weight: 600; }
        .total-row { background: #E2E8F0; font-weight: 700; }
        .line-item { border-bottom: 1px solid #F1F5F9; }
        .line-item:hover { background: #FAFAFA; }
    </style>
</head>
<body class="min-h-screen text-slate-700">
    <!-- HEADER -->
    <header class="bg-white/90 backdrop-blur-sm border-b border-slate-200 px-6 py-4 sticky top-0 z-50 no-print shadow-sm">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                    <div class="w-10 h-10 bg-gradient-to-br from-sage-500 to-sage-600 rounded-xl flex items-center justify-center shadow-md">
                        <span class="text-white font-bold text-sm">IP</span>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-slate-800">Investor Pro Forma</h1>
                        <p class="text-xs text-slate-500">Complete Investment Analysis</p>
                    </div>
                </a>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="exportData()" class="px-4 py-2 text-sm font-medium text-sage-700 bg-sage-50 hover:bg-sage-100 rounded-lg transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                    Export
                </button>
                <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Import
                </button>
                <input type="file" id="importFile" accept=".json" onchange="importData(event)" class="hidden">
                <button onclick="resetAll()" class="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-lg transition-colors">Reset</button>
                <button onclick="window.print()" class="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-lg transition-colors">Print</button>
                <a href="/" class="px-4 py-2 text-sm font-medium text-white bg-sage-600 hover:bg-sage-700 rounded-lg transition-colors shadow-sm">← Back</a>
            </div>
        </div>
    </header>

    <main id="app" class="max-w-7xl mx-auto px-6 py-8">
        <div class="text-center py-20"><div class="text-sage-500 text-xl">Loading...</div></div>
    </main>

    <footer class="bg-white border-t border-slate-200 py-6 mt-12 no-print">
        <div class="max-w-7xl mx-auto px-6 text-center text-sm text-slate-500">
            <p>Free tool by <a href="/" class="text-sage-600 hover:underline font-medium">Zachary Vorsteg</a> • <a href="/#book-discovery" class="text-sage-600 hover:underline">Questions?</a></p>
        </div>
    </footer>

    <script>
    // ============================================================================
    // STATE
    // ============================================================================
    
    const defaultUnits = [];
    for (let i = 1; i <= 4; i++) {
        defaultUnits.push({ id: String(i), unitNumber: `Unit ${i}`, tenant: '', sqft: 800, rent: 1500 });
    }

    const defaultInputs = {
        propertyName: 'My Investment Property',
        propertyAddress: '',
        // Acquisition
        purchasePrice: 500000,
        closingCosts: 10000,
        immediateRepairs: 0,
        // Financing
        downPaymentPct: 25,
        interestRate: 7.0,
        loanTermYears: 30,
        // Units
        units: JSON.parse(JSON.stringify(defaultUnits)),
        // Other Income
        laundryIncome: 0,
        parkingIncome: 0,
        otherIncome: 0,
        // Vacancy
        vacancyPct: 5,
        // Operating Expenses
        realEstateTaxes: 6000,
        insurance: 2400,
        repairsMaintenance: 2000,
        utilities: 1800,
        management: 0,
        managementPct: 8,
        trash: 600,
        landscaping: 600,
        reserves: 1200,
        // Leasing & Capital Costs
        leaseCommissions: 0,
        leaseCommissionsPct: 0,
        tenantImprovements: 0,
        tenantImprovementsPSF: 0,
        capitalReserves: 1000,
        // Growth
        annualRentIncrease: 3,
        annualExpenseIncrease: 2,
        projectionYears: 5,
        exitCapRate: 6,
    };

    let inputs = JSON.parse(localStorage.getItem('proforma-v3') || 'null') || JSON.parse(JSON.stringify(defaultInputs));

    // ============================================================================
    // HELPERS
    // ============================================================================

    const fmt = n => isNaN(n) || !isFinite(n) ? '0' : Math.round(n).toLocaleString('en-US');
    const fmtDec = (n, dec = 2) => isNaN(n) || !isFinite(n) ? '0.00' : n.toLocaleString('en-US', { minimumFractionDigits: dec, maximumFractionDigits: dec });

    let renderTimeout = null;
    function save() { localStorage.setItem('proforma-v3', JSON.stringify(inputs)); if (renderTimeout) cancelAnimationFrame(renderTimeout); renderTimeout = requestAnimationFrame(render); }
    function resetAll() { if (confirm('Reset all values to defaults?')) { inputs = JSON.parse(JSON.stringify(defaultInputs)); save(); } }
    function setInput(key, value) { inputs[key] = value; save(); }
    function setNumInput(key, value) { inputs[key] = parseFloat(value) || 0; save(); }
    function updateUnit(id, field, value) {
        const unit = inputs.units.find(u => u.id === id);
        if (unit) { unit[field] = (field === 'unitNumber' || field === 'tenant') ? value : (parseFloat(value) || 0); save(); }
    }
    function addUnit() { inputs.units.push({ id: String(Date.now()), unitNumber: `Unit ${inputs.units.length + 1}`, tenant: '', sqft: 800, rent: 1500 }); save(); }
    function removeUnit(id) { if (inputs.units.length > 1) { inputs.units = inputs.units.filter(u => u.id !== id); save(); } }

    // Export/Import
    function exportData() {
        const data = { version: '3.0', exported: new Date().toISOString(), propertyName: inputs.propertyName, data: inputs };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `proforma-${inputs.propertyName.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (imported.data) {
                    inputs = { ...defaultInputs, ...imported.data };
                    save();
                    alert('Pro Forma imported successfully!');
                }
            } catch (err) { alert('Error: ' + err.message); }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    // ============================================================================
    // CALCULATIONS
    // ============================================================================

    function calculate() {
        const { purchasePrice, closingCosts, immediateRepairs, downPaymentPct, interestRate, loanTermYears, units,
            laundryIncome, parkingIncome, otherIncome, realEstateTaxes, insurance, repairsMaintenance, utilities,
            management, managementPct, trash, landscaping, reserves, leaseCommissions, leaseCommissionsPct,
            tenantImprovements, tenantImprovementsPSF, capitalReserves, vacancyPct, annualRentIncrease, annualExpenseIncrease, projectionYears } = inputs;

        const totalUnits = units.length;
        const totalSqft = units.reduce((sum, u) => sum + u.sqft, 0);
        const monthlyRent = units.reduce((sum, u) => sum + u.rent, 0);
        const annualRent = monthlyRent * 12;
        const pricePerSqft = totalSqft > 0 ? purchasePrice / totalSqft : 0;
        const pricePerUnit = totalUnits > 0 ? purchasePrice / totalUnits : 0;
        
        // Income
        const monthlyOtherIncome = laundryIncome + parkingIncome + otherIncome;
        const annualOtherIncome = monthlyOtherIncome * 12;
        const grossPotentialIncome = annualRent + annualOtherIncome;
        const vacancyLoss = grossPotentialIncome * (vacancyPct / 100);
        const effectiveGrossRevenue = grossPotentialIncome - vacancyLoss;

        // Financing
        const downPayment = purchasePrice * (downPaymentPct / 100);
        const loanAmount = purchasePrice - downPayment;
        const ltv = purchasePrice > 0 ? (loanAmount / purchasePrice) * 100 : 0;
        const monthlyRate = interestRate / 100 / 12;
        const numPayments = loanTermYears * 12;
        const monthlyMortgage = loanAmount > 0 && monthlyRate > 0 ? loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1) : 0;
        const annualDebtService = monthlyMortgage * 12;
        const totalCashRequired = downPayment + closingCosts + immediateRepairs;

        // Operating Expenses
        const calcManagement = managementPct > 0 ? effectiveGrossRevenue * (managementPct / 100) : management;
        const totalOperatingExpenses = realEstateTaxes + insurance + repairsMaintenance + utilities + calcManagement + trash + landscaping + reserves;
        
        // NOI
        const noi = effectiveGrossRevenue - totalOperatingExpenses;

        // Leasing & Capital Costs
        const calcLeaseCommissions = leaseCommissionsPct > 0 ? annualRent * (leaseCommissionsPct / 100) : leaseCommissions;
        const calcTenantImprovements = tenantImprovementsPSF > 0 ? totalSqft * tenantImprovementsPSF : tenantImprovements;
        const totalLeasingCapitalCosts = calcLeaseCommissions + calcTenantImprovements + capitalReserves;

        // Cash Flow
        const cashFlowBeforeDebt = noi - totalLeasingCapitalCosts;
        const cashFlowAfterDebt = cashFlowBeforeDebt - annualDebtService;

        // Returns
        const capRate = purchasePrice > 0 ? (noi / purchasePrice) * 100 : 0;
        const cashOnCash = totalCashRequired > 0 ? (cashFlowAfterDebt / totalCashRequired) * 100 : 0;
        const grossRentMultiplier = annualRent > 0 ? purchasePrice / annualRent : 0;
        const dscr = annualDebtService > 0 ? noi / annualDebtService : 999;
        const expenseRatio = effectiveGrossRevenue > 0 ? (totalOperatingExpenses / effectiveGrossRevenue) * 100 : 0;
        const roi = totalCashRequired > 0 ? (cashFlowAfterDebt / totalCashRequired) * 100 : 0;

        // Projections
        const years = [];
        const currentYear = new Date().getFullYear();
        for (let i = 0; i <= projectionYears; i++) {
            const rentGrowth = Math.pow(1 + annualRentIncrease / 100, i);
            const expenseGrowth = Math.pow(1 + annualExpenseIncrease / 100, i);
            const yGPI = grossPotentialIncome * rentGrowth;
            const yVacancy = yGPI * (vacancyPct / 100);
            const yEGR = yGPI - yVacancy;
            const yOpex = (totalOperatingExpenses - calcManagement) * expenseGrowth + (yEGR * managementPct / 100);
            const yNOI = yEGR - yOpex;
            const yLeasingCap = totalLeasingCapitalCosts * expenseGrowth;
            const yCFBeforeDebt = yNOI - yLeasingCap;
            const yCFAfterDebt = yCFBeforeDebt - annualDebtService;
            years.push({ year: currentYear + i, gpi: yGPI, vacancy: yVacancy, egr: yEGR, opex: yOpex, noi: yNOI, leasingCap: yLeasingCap, cfBeforeDebt: yCFBeforeDebt, debtService: annualDebtService, cfAfterDebt: yCFAfterDebt });
        }

        return {
            totalUnits, totalSqft, monthlyRent, annualRent, pricePerSqft, pricePerUnit,
            annualOtherIncome, grossPotentialIncome, vacancyLoss, effectiveGrossRevenue,
            downPayment, loanAmount, ltv, monthlyMortgage, annualDebtService, totalCashRequired,
            realEstateTaxes, insurance, repairsMaintenance, utilities, calcManagement, trash, landscaping, reserves, totalOperatingExpenses,
            noi,
            calcLeaseCommissions, calcTenantImprovements, capitalReserves, totalLeasingCapitalCosts,
            cashFlowBeforeDebt, cashFlowAfterDebt,
            capRate, cashOnCash, grossRentMultiplier, dscr, expenseRatio, roi,
            years
        };
    }

    function getGrade(calc) {
        const { capRate, cashOnCash, dscr, expenseRatio } = calc;
        const isCashDeal = inputs.downPaymentPct >= 100 || calc.loanAmount <= 0;
        let score = 50;
        if (cashOnCash >= 10) score += 20; else if (cashOnCash >= 6) score += 12; else if (cashOnCash >= 0) score += 4; else score -= 15;
        if (isCashDeal) score += 8; else if (dscr >= 1.3) score += 12; else if (dscr >= 1.15) score += 6; else if (dscr < 1) score -= 15;
        if (capRate >= 7) score += 10; else if (capRate >= 5.5) score += 5; else if (capRate < 4.5) score -= 5;
        if (expenseRatio <= 42) score += 6; else if (expenseRatio > 52) score -= 6;
        score = Math.max(0, Math.min(100, score));
        const grade = score >= 80 ? 'A' : score >= 68 ? 'B' : score >= 55 ? 'C' : score >= 40 ? 'D' : 'F';
        return { score, grade };
    }

    // ============================================================================
    // RENDER
    // ============================================================================

    function render() {
        const calc = calculate();
        const { score, grade } = getGrade(calc);
        const gradeColors = { A: 'from-sage-500 to-sage-600', B: 'from-blue-500 to-blue-600', C: 'from-amber-500 to-amber-600', D: 'from-orange-500 to-orange-600', F: 'from-red-400 to-red-500' };

        document.getElementById('app').innerHTML = `
        <!-- TOP SUMMARY -->
        <div class="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
            <div class="card p-4 flex items-center gap-4">
                <div class="w-16 h-16 bg-gradient-to-br ${gradeColors[grade]} rounded-xl flex items-center justify-center shadow-lg">
                    <span class="text-3xl font-bold text-white">${grade}</span>
                </div>
                <div>
                    <div class="text-sm text-slate-500">Grade</div>
                    <div class="text-lg font-bold text-slate-800">${score}/100</div>
                </div>
            </div>
            <div class="card p-4 text-center">
                <div class="text-2xl font-bold text-slate-800">${fmtDec(calc.capRate, 1)}%</div>
                <div class="text-sm text-slate-500">Cap Rate</div>
            </div>
            <div class="card p-4 text-center">
                <div class="text-2xl font-bold ${calc.cashOnCash >= 8 ? 'text-sage-600' : calc.cashOnCash < 0 ? 'text-red-500' : 'text-slate-800'}">${fmtDec(calc.cashOnCash, 1)}%</div>
                <div class="text-sm text-slate-500">Cash-on-Cash</div>
            </div>
            <div class="card p-4 text-center">
                <div class="text-2xl font-bold ${calc.dscr >= 1.25 ? 'text-sage-600' : calc.dscr < 1 ? 'text-red-500' : 'text-amber-600'}">${fmtDec(calc.dscr, 2)}x</div>
                <div class="text-sm text-slate-500">DSCR</div>
            </div>
            <div class="card p-4 text-center">
                <div class="text-2xl font-bold ${calc.cashFlowAfterDebt >= 0 ? 'text-sage-600' : 'text-red-500'}">$${fmt(calc.cashFlowAfterDebt)}</div>
                <div class="text-sm text-slate-500">Cash Flow</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- PROPERTY INFO -->
            <div class="card overflow-hidden">
                <div class="section-header px-5 py-3">Property Information</div>
                <div class="p-5 space-y-3">
                    <div>
                        <label class="block text-xs font-medium text-slate-500 mb-1">Property Name</label>
                        <input type="text" value="${inputs.propertyName}" onchange="setInput('propertyName', this.value)" class="input-field w-full px-3 py-2 rounded-lg font-semibold">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-500 mb-1">Address</label>
                        <input type="text" value="${inputs.propertyAddress}" onchange="setInput('propertyAddress', this.value)" placeholder="Enter address..." class="input-field w-full px-3 py-2 rounded-lg text-sm">
                    </div>
                    <div class="grid grid-cols-2 gap-3 pt-2">
                        <div class="bg-slate-50 rounded-lg p-3 text-center"><div class="text-xl font-bold">${calc.totalUnits}</div><div class="text-xs text-slate-500">Units</div></div>
                        <div class="bg-slate-50 rounded-lg p-3 text-center"><div class="text-xl font-bold">${fmt(calc.totalSqft)}</div><div class="text-xs text-slate-500">Sq Ft</div></div>
                    </div>
                </div>
            </div>

            <!-- ACQUISITION -->
            <div class="card overflow-hidden">
                <div class="section-header px-5 py-3">Acquisition</div>
                <div class="p-5 space-y-3">
                    ${compactInput('Purchase Price', 'purchasePrice', '$')}
                    ${compactInput('Closing Costs', 'closingCosts', '$')}
                    ${compactInput('Immediate Repairs', 'immediateRepairs', '$')}
                    <div class="pt-2 border-t border-slate-100">
                        <div class="flex justify-between py-1"><span class="text-slate-600">Price/Unit</span><span class="font-semibold">$${fmt(calc.pricePerUnit)}</span></div>
                        <div class="flex justify-between py-1"><span class="text-slate-600">Price/SF</span><span class="font-semibold">$${fmtDec(calc.pricePerSqft, 0)}</span></div>
                    </div>
                </div>
            </div>

            <!-- FINANCING -->
            <div class="card overflow-hidden">
                <div class="section-header px-5 py-3">Financing</div>
                <div class="p-5 space-y-3">
                    ${compactInput('Down Payment', 'downPaymentPct', '', '%')}
                    ${compactInput('Interest Rate', 'interestRate', '', '%')}
                    ${compactInput('Loan Term', 'loanTermYears', '', 'yrs')}
                    <div class="pt-2 border-t border-slate-100">
                        <div class="flex justify-between py-1"><span class="text-slate-600">Loan Amount</span><span class="font-semibold text-sage-700">$${fmt(calc.loanAmount)}</span></div>
                        <div class="flex justify-between py-1"><span class="text-slate-600">Monthly P&I</span><span class="font-semibold">$${fmt(calc.monthlyMortgage)}</span></div>
                        <div class="flex justify-between py-1"><span class="text-slate-600">Total Cash Required</span><span class="font-semibold text-warm-700">$${fmt(calc.totalCashRequired)}</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RENT ROLL -->
        <div class="card overflow-hidden mb-6">
            <div class="section-header px-5 py-3 flex items-center justify-between">
                <span>Rent Roll</span>
                <button onclick="addUnit()" class="px-3 py-1 bg-sage-500 hover:bg-sage-600 text-white text-sm font-medium rounded-lg transition-colors">+ Add</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-4 py-3 text-left font-semibold text-slate-600">Unit</th>
                            <th class="px-4 py-3 text-left font-semibold text-slate-600">Tenant</th>
                            <th class="px-4 py-3 text-right font-semibold text-slate-600">Sq Ft</th>
                            <th class="px-4 py-3 text-right font-semibold text-slate-600">Rent/Mo</th>
                            <th class="px-4 py-3 text-right font-semibold text-slate-600">Annual</th>
                            <th class="px-4 py-3 text-right font-semibold text-slate-600">$/SF</th>
                            <th class="px-2 py-3 w-8"></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${inputs.units.map(u => `
                        <tr class="line-item">
                            <td class="px-4 py-2"><input type="text" value="${u.unitNumber}" onchange="updateUnit('${u.id}', 'unitNumber', this.value)" class="input-field w-20 px-2 py-1.5 rounded text-sm"></td>
                            <td class="px-4 py-2"><input type="text" value="${u.tenant || ''}" onchange="updateUnit('${u.id}', 'tenant', this.value)" placeholder="—" class="input-field w-28 px-2 py-1.5 rounded text-sm ${(u.tenant || '').toLowerCase() === 'vacant' ? '!border-amber-300 !bg-amber-50' : ''}"></td>
                            <td class="px-4 py-2 text-right"><input type="number" value="${u.sqft}" onchange="updateUnit('${u.id}', 'sqft', this.value)" class="input-field w-16 px-2 py-1.5 rounded text-sm text-right"></td>
                            <td class="px-4 py-2 text-right"><input type="number" value="${u.rent}" onchange="updateUnit('${u.id}', 'rent', this.value)" class="input-field w-20 px-2 py-1.5 rounded text-sm text-right"></td>
                            <td class="px-4 py-2 text-right text-slate-600">$${fmt(u.rent * 12)}</td>
                            <td class="px-4 py-2 text-right text-slate-500">$${fmtDec(u.sqft > 0 ? u.rent / u.sqft : 0)}</td>
                            <td class="px-2 py-2">${inputs.units.length > 1 ? `<button onclick="removeUnit('${u.id}')" class="text-slate-400 hover:text-red-500">×</button>` : ''}</td>
                        </tr>`).join('')}
                    </tbody>
                    <tfoot class="bg-sage-50 border-t-2 border-sage-200">
                        <tr>
                            <td class="px-4 py-3 font-bold text-sage-700">TOTAL</td>
                            <td class="px-4 py-3 text-slate-500 text-xs">${inputs.units.filter(u => (u.tenant || '').toLowerCase() === 'vacant').length} vacant</td>
                            <td class="px-4 py-3 text-right font-bold">${fmt(calc.totalSqft)}</td>
                            <td class="px-4 py-3 text-right font-bold text-sage-700">$${fmt(calc.monthlyRent)}</td>
                            <td class="px-4 py-3 text-right font-bold text-sage-700">$${fmt(calc.annualRent)}</td>
                            <td class="px-4 py-3 text-right">$${fmtDec(calc.totalSqft > 0 ? calc.monthlyRent / calc.totalSqft : 0)}</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- OPERATING STATEMENT -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- INCOME & EXPENSES -->
            <div class="card overflow-hidden">
                <div class="section-header px-5 py-3">Operating Statement</div>
                <table class="w-full text-sm">
                    <tbody>
                        <!-- INCOME -->
                        <tr class="bg-sage-50"><td colspan="2" class="px-5 py-2 font-bold text-sage-700 text-xs uppercase tracking-wide">Income</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Annual Rent</td><td class="px-5 py-2 text-right font-medium">$${fmt(calc.annualRent)}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Other Income</td><td class="px-5 py-2 text-right">${inlineInput('otherIncome', '$', '/mo')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Gross Potential Income</td><td class="px-5 py-2 text-right font-medium">$${fmt(calc.grossPotentialIncome)}</td></tr>
                        <tr class="line-item bg-amber-50"><td class="px-5 py-2 text-slate-600">Vacancy Factor</td><td class="px-5 py-2 text-right">${inlineInput('vacancyPct', '', '%')}</td></tr>
                        <tr class="subtotal-row"><td class="px-5 py-2 font-bold">Effective Gross Revenue</td><td class="px-5 py-2 text-right font-bold text-sage-700">$${fmt(calc.effectiveGrossRevenue)}</td></tr>
                        
                        <!-- EXPENSES -->
                        <tr class="bg-warm-50"><td colspan="2" class="px-5 py-2 font-bold text-warm-700 text-xs uppercase tracking-wide">Operating Expenses</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Real Estate Taxes</td><td class="px-5 py-2 text-right">${inlineInput('realEstateTaxes', '$')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Insurance</td><td class="px-5 py-2 text-right">${inlineInput('insurance', '$')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Repairs & Maintenance</td><td class="px-5 py-2 text-right">${inlineInput('repairsMaintenance', '$')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Utilities</td><td class="px-5 py-2 text-right">${inlineInput('utilities', '$')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Management</td><td class="px-5 py-2 text-right">${inlineInput('managementPct', '', '%')} <span class="text-slate-400 text-xs ml-1">($${fmt(calc.calcManagement)})</span></td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Trash</td><td class="px-5 py-2 text-right">${inlineInput('trash', '$')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Landscape</td><td class="px-5 py-2 text-right">${inlineInput('landscaping', '$')}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Reserves</td><td class="px-5 py-2 text-right">${inlineInput('reserves', '$')}</td></tr>
                        <tr class="subtotal-row"><td class="px-5 py-2 font-bold">Total Operating Expenses</td><td class="px-5 py-2 text-right font-bold text-warm-700">$${fmt(calc.totalOperatingExpenses)}</td></tr>
                        
                        <!-- NOI -->
                        <tr class="total-row bg-slate-200"><td class="px-5 py-3 font-bold text-lg">NOI</td><td class="px-5 py-3 text-right font-bold text-lg text-sage-700">$${fmt(calc.noi)}</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- LEASING & CASH FLOW -->
            <div class="card overflow-hidden">
                <div class="section-header px-5 py-3">Cash Flow Analysis</div>
                <table class="w-full text-sm">
                    <tbody>
                        <!-- LEASING & CAPITAL -->
                        <tr class="bg-blue-50"><td colspan="2" class="px-5 py-2 font-bold text-blue-700 text-xs uppercase tracking-wide">Leasing & Capital Costs</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Lease Commissions</td><td class="px-5 py-2 text-right">${inlineInput('leaseCommissionsPct', '', '%')} <span class="text-slate-400 text-xs ml-1">($${fmt(calc.calcLeaseCommissions)})</span></td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Tenant Improvements</td><td class="px-5 py-2 text-right">${inlineInput('tenantImprovementsPSF', '$', '/sf')} <span class="text-slate-400 text-xs ml-1">($${fmt(calc.calcTenantImprovements)})</span></td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Capital Reserves</td><td class="px-5 py-2 text-right">${inlineInput('capitalReserves', '$')}</td></tr>
                        <tr class="subtotal-row"><td class="px-5 py-2 font-bold">Total Leasing & Capital Costs</td><td class="px-5 py-2 text-right font-bold text-blue-700">$${fmt(calc.totalLeasingCapitalCosts)}</td></tr>
                        
                        <!-- CASH FLOW -->
                        <tr class="bg-purple-50"><td colspan="2" class="px-5 py-2 font-bold text-purple-700 text-xs uppercase tracking-wide">Cash Flow</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Cash Flow Before Debt Service</td><td class="px-5 py-2 text-right font-medium ${calc.cashFlowBeforeDebt >= 0 ? '' : 'text-red-500'}">$${fmt(calc.cashFlowBeforeDebt)}</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Debt Service</td><td class="px-5 py-2 text-right font-medium text-red-600">($${fmt(calc.annualDebtService)})</td></tr>
                        <tr class="total-row bg-slate-200"><td class="px-5 py-3 font-bold text-lg">Cash Flow After Debt Service</td><td class="px-5 py-3 text-right font-bold text-lg ${calc.cashFlowAfterDebt >= 0 ? 'text-sage-700' : 'text-red-500'}">$${fmt(calc.cashFlowAfterDebt)}</td></tr>
                        
                        <!-- ROI -->
                        <tr class="bg-slate-100"><td colspan="2" class="px-5 py-2 font-bold text-slate-700 text-xs uppercase tracking-wide">Returns</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Cap Rate</td><td class="px-5 py-2 text-right font-semibold">${fmtDec(calc.capRate, 2)}%</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Cash-on-Cash Return</td><td class="px-5 py-2 text-right font-semibold ${calc.cashOnCash >= 8 ? 'text-sage-600' : calc.cashOnCash < 0 ? 'text-red-500' : ''}">${fmtDec(calc.cashOnCash, 2)}%</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">DSCR</td><td class="px-5 py-2 text-right font-semibold ${calc.dscr >= 1.25 ? 'text-sage-600' : calc.dscr < 1 ? 'text-red-500' : 'text-amber-600'}">${fmtDec(calc.dscr, 2)}x</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">Expense Ratio</td><td class="px-5 py-2 text-right font-semibold">${fmtDec(calc.expenseRatio, 1)}%</td></tr>
                        <tr class="line-item"><td class="px-5 py-2 text-slate-600">GRM</td><td class="px-5 py-2 text-right font-semibold">${fmtDec(calc.grossRentMultiplier, 1)}x</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- PROJECTION TABLE -->
        <div class="card overflow-hidden">
            <div class="section-header px-5 py-3 flex items-center justify-between">
                <span>${inputs.projectionYears + 1}-Year Projection</span>
                <div class="flex items-center gap-4 text-sm">
                    <label class="flex items-center gap-2"><span class="text-slate-500">Rent Growth:</span><input type="number" value="${inputs.annualRentIncrease}" onchange="setNumInput('annualRentIncrease', this.value)" class="input-field w-14 px-2 py-1 rounded text-center" step="0.5">%</label>
                    <label class="flex items-center gap-2"><span class="text-slate-500">Years:</span><input type="number" value="${inputs.projectionYears}" onchange="setNumInput('projectionYears', this.value)" class="input-field w-12 px-2 py-1 rounded text-center"></label>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-4 py-3 text-left font-semibold text-slate-600 sticky-col bg-slate-50 min-w-[180px]">Line Item</th>
                            ${calc.years.map(y => `<th class="px-3 py-3 text-right font-semibold text-slate-600 min-w-[90px]">${y.year}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="line-item"><td class="px-4 py-2 text-slate-600 sticky-col bg-white">Gross Potential Income</td>${calc.years.map(y => `<td class="px-3 py-2 text-right">$${fmt(y.gpi)}</td>`).join('')}</tr>
                        <tr class="line-item"><td class="px-4 py-2 text-slate-500 sticky-col bg-white pl-6">Less: Vacancy</td>${calc.years.map(y => `<td class="px-3 py-2 text-right text-red-500">($${fmt(y.vacancy)})</td>`).join('')}</tr>
                        <tr class="subtotal-row"><td class="px-4 py-2 font-semibold sticky-col bg-slate-100">Effective Gross Revenue</td>${calc.years.map(y => `<td class="px-3 py-2 text-right font-semibold">$${fmt(y.egr)}</td>`).join('')}</tr>
                        <tr class="line-item"><td class="px-4 py-2 text-slate-500 sticky-col bg-white pl-6">Less: Operating Expenses</td>${calc.years.map(y => `<td class="px-3 py-2 text-right text-warm-600">($${fmt(y.opex)})</td>`).join('')}</tr>
                        <tr class="total-row"><td class="px-4 py-3 font-bold sticky-col bg-slate-200">NOI</td>${calc.years.map(y => `<td class="px-3 py-3 text-right font-bold text-sage-700">$${fmt(y.noi)}</td>`).join('')}</tr>
                        <tr class="line-item"><td class="px-4 py-2 text-slate-500 sticky-col bg-white pl-6">Less: Leasing & Capital</td>${calc.years.map(y => `<td class="px-3 py-2 text-right text-blue-600">($${fmt(y.leasingCap)})</td>`).join('')}</tr>
                        <tr class="subtotal-row"><td class="px-4 py-2 font-semibold sticky-col bg-slate-100">Cash Flow Before Debt</td>${calc.years.map(y => `<td class="px-3 py-2 text-right font-semibold ${y.cfBeforeDebt < 0 ? 'text-red-500' : ''}">$${fmt(y.cfBeforeDebt)}</td>`).join('')}</tr>
                        <tr class="line-item"><td class="px-4 py-2 text-slate-500 sticky-col bg-white pl-6">Less: Debt Service</td>${calc.years.map(y => `<td class="px-3 py-2 text-right text-red-600">($${fmt(y.debtService)})</td>`).join('')}</tr>
                        <tr class="total-row bg-sage-100"><td class="px-4 py-3 font-bold sticky-col bg-sage-100">Cash Flow After Debt</td>${calc.years.map(y => `<td class="px-3 py-3 text-right font-bold ${y.cfAfterDebt < 0 ? 'text-red-500' : 'text-sage-700'}">$${fmt(y.cfAfterDebt)}</td>`).join('')}</tr>
                        <tr class="bg-white"><td class="px-4 py-2 text-slate-600 sticky-col bg-white">Cash-on-Cash Return</td>${calc.years.map(y => { const c = calc.totalCashRequired > 0 ? (y.cfAfterDebt / calc.totalCashRequired) * 100 : 0; return `<td class="px-3 py-2 text-right ${c >= 8 ? 'text-sage-600 font-semibold' : c < 0 ? 'text-red-500' : ''}">${fmtDec(c, 1)}%</td>`; }).join('')}</tr>
                    </tbody>
                </table>
            </div>
        </div>
        `;
    }

    // ============================================================================
    // TEMPLATE HELPERS
    // ============================================================================

    function compactInput(label, key, prefix = '', suffix = '') {
        return `<div class="flex items-center justify-between"><span class="text-sm text-slate-600">${label}</span><div class="flex items-center input-field rounded-lg overflow-hidden w-32">${prefix ? `<span class="pl-2 text-slate-400 text-sm">${prefix}</span>` : ''}<input type="number" value="${inputs[key]}" onchange="setNumInput('${key}', this.value)" class="w-full px-2 py-1.5 text-right text-sm bg-transparent border-0 focus:outline-none">${suffix ? `<span class="pr-2 text-slate-400 text-sm">${suffix}</span>` : ''}</div></div>`;
    }

    function inlineInput(key, prefix = '', suffix = '') {
        return `<span class="inline-flex items-center input-field rounded overflow-hidden">${prefix ? `<span class="pl-2 text-slate-400 text-xs">${prefix}</span>` : ''}<input type="number" value="${inputs[key]}" onchange="setNumInput('${key}', this.value)" class="w-16 px-1 py-1 text-right text-sm bg-transparent border-0 focus:outline-none">${suffix ? `<span class="pr-2 text-slate-400 text-xs">${suffix}</span>` : ''}</span>`;
    }

    // Initialize
    render();
    </script>
</body>
</html>
