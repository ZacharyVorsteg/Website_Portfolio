<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor Pro Forma | Zachary Vorsteg</title>
    <meta name="description" content="Free real estate investment pro forma analysis tool. Easy-to-use cap rate, cash-on-cash, and projection calculator.">
    <link rel="canonical" href="https://zacharyvorsteg.com/proforma.html">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        cream: { 50: '#FFFDF7', 100: '#FFF9E8', 200: '#FFF3D1' },
                        sage: { 50: '#F0F5F0', 100: '#E1EBE1', 500: '#5B8A5B', 600: '#4A7A4A' },
                        warm: { 50: '#FDF8F3', 100: '#F9EFE5', 200: '#F0E0CE', 500: '#C4956A', 600: '#A67B4F' },
                        slate: { 50: '#F8FAFC', 100: '#F1F5F9', 200: '#E2E8F0', 300: '#CBD5E1', 400: '#94A3B8', 500: '#64748B', 600: '#475569', 700: '#334155', 800: '#1E293B' }
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; background: linear-gradient(180deg, #FFFDF7 0%, #F8FAFC 100%); }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        .sticky-col { position: sticky; left: 0; z-index: 10; }
        @media print { .no-print { display: none !important; } body { background: white; } }
        .help-tip { position: relative; cursor: help; }
        .help-tip:hover .help-content { display: block; }
        .help-content { display: none; position: absolute; left: 0; top: 100%; z-index: 50; width: 250px; padding: 12px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); font-size: 13px; line-height: 1.5; color: #475569; }
    </style>
</head>
<body class="min-h-screen text-slate-700">
    <!-- WELCOME HEADER -->
    <header class="bg-white/80 backdrop-blur-sm border-b border-slate-200 px-6 py-4 sticky top-0 z-50 no-print">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                    <div class="w-10 h-10 bg-gradient-to-br from-sage-500 to-sage-600 rounded-xl flex items-center justify-center shadow-sm">
                        <span class="text-white font-bold text-sm">IP</span>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-slate-800">Investor Pro Forma</h1>
                        <p class="text-xs text-slate-500">Free Investment Analysis Tool</p>
                    </div>
                </a>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="resetAll()" class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors">Reset</button>
                <button onclick="window.print()" class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors">Print</button>
                <a href="/" class="px-4 py-2 text-sm font-medium text-white bg-sage-500 hover:bg-sage-600 rounded-lg transition-colors shadow-sm">‚Üê Back to Site</a>
            </div>
        </div>
    </header>

    <!-- GETTING STARTED GUIDE -->
    <div class="bg-gradient-to-r from-sage-50 to-cream-100 border-b border-sage-100 px-6 py-5 no-print">
        <div class="max-w-6xl mx-auto">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-sage-500 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm">
                    <span class="text-white text-lg">?</span>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-slate-800 mb-2">How to Use This Tool</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-slate-600">
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">1</span>
                            <span><strong>Property Details</strong> ‚Äî Enter property info and purchase price below</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">2</span>
                            <span><strong>Rent Roll</strong> ‚Äî Add your units with rents and square footage</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">3</span>
                            <span><strong>Expenses</strong> ‚Äî Input your annual operating costs</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">4</span>
                            <span><strong>Results</strong> ‚Äî View your investment grade and projections</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main id="app" class="max-w-6xl mx-auto px-6 py-8">
        <div class="text-center py-20">
            <div class="text-sage-500 text-xl">Loading...</div>
        </div>
    </main>

    <footer class="bg-white border-t border-slate-200 py-6 mt-12 no-print">
        <div class="max-w-6xl mx-auto px-6 text-center text-sm text-slate-500">
            <p>Free tool by <a href="/" class="text-sage-600 hover:underline font-medium">Zachary Vorsteg</a> ‚Ä¢ Questions? <a href="/#book-discovery" class="text-sage-600 hover:underline">Get in touch</a></p>
        </div>
    </footer>

    <script>
    // ============================================================================
    // STATE
    // ============================================================================
    
    const defaultUnits = [];
    for (let i = 1; i <= 4; i++) {
        defaultUnits.push({ id: String(i), unitNumber: `Unit ${i}`, tenant: '', sqft: 800, rent: 1500 });
    }

    const defaultInputs = {
        propertyName: 'My Investment Property',
        propertyAddress: '',
        purchasePrice: 500000,
        closingCosts: 10000,
        immediateRepairs: 0,
        downPaymentPct: 25,
        interestRate: 7.0,
        loanTermYears: 30,
        units: JSON.parse(JSON.stringify(defaultUnits)),
        laundryIncome: 0,
        parkingIncome: 0,
        storageIncome: 0,
        otherIncome: 0,
        realEstateTaxes: 6000,
        insurance: 2400,
        water: 1200,
        sewer: 600,
        gas: 0,
        electric: 0,
        trash: 600,
        landscaping: 600,
        snowRemoval: 0,
        repairsMaintenance: 2000,
        pestControl: 300,
        managementPct: 8,
        legalAccounting: 500,
        advertising: 200,
        miscellaneous: 500,
        replacementReserves: 1200,
        vacancyPct: 5,
        annualRentIncrease: 3,
        annualExpenseIncrease: 2,
        projectionYears: 5,
        exitCapRate: 6,
    };

    let inputs = JSON.parse(localStorage.getItem('proforma-soft') || 'null') || JSON.parse(JSON.stringify(defaultInputs));

    // ============================================================================
    // HELPERS
    // ============================================================================

    const fmt = n => isNaN(n) || !isFinite(n) ? '0' : Math.round(n).toLocaleString('en-US');
    const fmtDec = (n, dec = 2) => isNaN(n) || !isFinite(n) ? '0.00' : n.toLocaleString('en-US', { minimumFractionDigits: dec, maximumFractionDigits: dec });

    function save() { localStorage.setItem('proforma-soft', JSON.stringify(inputs)); render(); }
    function resetAll() { if (confirm('Reset all values to defaults?')) { inputs = JSON.parse(JSON.stringify(defaultInputs)); save(); } }
    function setInput(key, value) { inputs[key] = value; save(); }
    function setNumInput(key, value) { inputs[key] = parseFloat(value) || 0; save(); }
    function updateUnit(id, field, value) {
        const unit = inputs.units.find(u => u.id === id);
        if (unit) { unit[field] = (field === 'unitNumber' || field === 'tenant') ? value : (parseFloat(value) || 0); save(); }
    }
    function addUnit() { inputs.units.push({ id: String(Date.now()), unitNumber: `Unit ${inputs.units.length + 1}`, tenant: '', sqft: 800, rent: 1500 }); save(); }
    function removeUnit(id) { if (inputs.units.length > 1) { inputs.units = inputs.units.filter(u => u.id !== id); save(); } }

    // ============================================================================
    // CALCULATIONS
    // ============================================================================

    function calculate() {
        const { purchasePrice, closingCosts, immediateRepairs, downPaymentPct, interestRate, loanTermYears, units,
            laundryIncome, parkingIncome, storageIncome, otherIncome, realEstateTaxes, insurance, water, sewer, gas, electric, trash,
            landscaping, snowRemoval, repairsMaintenance, pestControl, managementPct, legalAccounting, advertising, miscellaneous, replacementReserves,
            vacancyPct, annualRentIncrease, annualExpenseIncrease, projectionYears } = inputs;

        const totalUnits = units.length;
        const totalSqft = units.reduce((sum, u) => sum + u.sqft, 0);
        const monthlyRent = units.reduce((sum, u) => sum + u.rent, 0);
        const annualRent = monthlyRent * 12;
        const pricePerSqft = totalSqft > 0 ? purchasePrice / totalSqft : 0;
        const pricePerUnit = totalUnits > 0 ? purchasePrice / totalUnits : 0;
        const monthlyOtherIncome = laundryIncome + parkingIncome + storageIncome + otherIncome;
        const grossPotentialIncome = annualRent + (monthlyOtherIncome * 12);
        const downPayment = purchasePrice * (downPaymentPct / 100);
        const loanAmount = purchasePrice - downPayment;
        const ltv = purchasePrice > 0 ? (loanAmount / purchasePrice) * 100 : 0;
        const monthlyRate = interestRate / 100 / 12;
        const numPayments = loanTermYears * 12;
        const monthlyMortgage = loanAmount > 0 && monthlyRate > 0 ? loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1) : 0;
        const annualDebtService = monthlyMortgage * 12;
        const totalCashRequired = downPayment + closingCosts + immediateRepairs;
        const year1Vacancy = grossPotentialIncome * (vacancyPct / 100);
        const year1EGI = grossPotentialIncome - year1Vacancy;
        const year1Management = year1EGI * (managementPct / 100);
        const baseExpenses = realEstateTaxes + insurance + water + sewer + gas + electric + trash + landscaping + snowRemoval + repairsMaintenance + pestControl + legalAccounting + advertising + miscellaneous + replacementReserves;
        const year1TotalExpenses = baseExpenses + year1Management;
        const year1NOI = year1EGI - year1TotalExpenses;
        const year1CashFlow = year1NOI - annualDebtService;
        const capRate = purchasePrice > 0 ? (year1NOI / purchasePrice) * 100 : 0;
        const cashOnCash = totalCashRequired > 0 ? (year1CashFlow / totalCashRequired) * 100 : 0;
        const grossRentMultiplier = annualRent > 0 ? purchasePrice / annualRent : 0;
        const dscr = annualDebtService > 0 ? year1NOI / annualDebtService : 999;
        const expenseRatio = year1EGI > 0 ? (year1TotalExpenses / year1EGI) * 100 : 0;

        const years = [];
        const currentYear = new Date().getFullYear();
        for (let i = 0; i <= projectionYears; i++) {
            const rentGrowth = Math.pow(1 + annualRentIncrease / 100, i);
            const expenseGrowth = Math.pow(1 + annualExpenseIncrease / 100, i);
            const gpi = grossPotentialIncome * rentGrowth;
            const vacancy = gpi * (vacancyPct / 100);
            const egi = gpi - vacancy;
            const totalOpex = (baseExpenses * expenseGrowth) + (egi * managementPct / 100);
            const noi = egi - totalOpex;
            const cashFlow = noi - annualDebtService;
            years.push({ year: currentYear + i, gpi, vacancy, egi, totalOpex, noi, cashFlow });
        }

        return { totalUnits, totalSqft, monthlyRent, annualRent, pricePerSqft, pricePerUnit, grossPotentialIncome, downPayment, loanAmount, ltv, monthlyMortgage, annualDebtService, totalCashRequired, year1EGI, year1TotalExpenses, year1NOI, year1CashFlow, years, capRate, cashOnCash, grossRentMultiplier, dscr, expenseRatio };
    }

    function getGrade(calc) {
        const { capRate, cashOnCash, dscr, expenseRatio } = calc;
        const isCashDeal = inputs.downPaymentPct >= 100 || calc.loanAmount <= 0;
        let score = 50;
        if (cashOnCash >= 10) score += 20; else if (cashOnCash >= 6) score += 12; else if (cashOnCash >= 0) score += 4; else score -= 15;
        if (isCashDeal) score += 8; else if (dscr >= 1.3) score += 12; else if (dscr >= 1.15) score += 6; else if (dscr < 1) score -= 15;
        if (capRate >= 7) score += 10; else if (capRate >= 5.5) score += 5; else if (capRate < 4.5) score -= 5;
        if (expenseRatio <= 42) score += 6; else if (expenseRatio > 52) score -= 6;
        score = Math.max(0, Math.min(100, score));
        const grade = score >= 80 ? 'A' : score >= 68 ? 'B' : score >= 55 ? 'C' : score >= 40 ? 'D' : 'F';
        return { score, grade };
    }

    // ============================================================================
    // RENDER
    // ============================================================================

    function render() {
        const calc = calculate();
        const { score, grade } = getGrade(calc);
        const gradeColors = { A: 'bg-sage-500 text-white', B: 'bg-blue-500 text-white', C: 'bg-warm-500 text-white', D: 'bg-orange-500 text-white', F: 'bg-red-400 text-white' };
        const gradeColor = gradeColors[grade] || gradeColors.C;

        document.getElementById('app').innerHTML = `
        <!-- INVESTMENT GRADE SUMMARY -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 ${gradeColor} rounded-2xl flex items-center justify-center shadow-lg">
                        <span class="text-4xl font-bold">${grade}</span>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800 mb-1">Investment Grade</h2>
                        <p class="text-slate-500">Score: ${score}/100 ‚Ä¢ ${grade === 'A' || grade === 'B' ? 'Strong investment potential' : grade === 'C' ? 'Moderate investment' : 'Needs improvement'}</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                    ${summaryMetric('Cap Rate', `${fmtDec(calc.capRate, 1)}%`, 'Annual return on property value')}
                    ${summaryMetric('Cash-on-Cash', `${fmtDec(calc.cashOnCash, 1)}%`, 'Return on your cash invested', calc.cashOnCash < 0)}
                    ${summaryMetric('DSCR', fmtDec(calc.dscr, 2), 'Debt service coverage ratio', calc.dscr < 1)}
                    ${summaryMetric('Cash Flow', `$${fmt(calc.year1CashFlow)}`, 'Annual cash flow after debt', calc.year1CashFlow < 0)}
                </div>
            </div>
        </section>

        <!-- PROPERTY & FINANCING -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Property Details -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-50 px-6 py-4 border-b border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800">üìç Property Details</h3>
                    <p class="text-sm text-slate-500">Basic information about the property</p>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property Name</label>
                        <input type="text" value="${inputs.propertyName}" onchange="setInput('propertyName', this.value)" class="w-full px-4 py-3 border border-slate-300 rounded-xl text-lg font-semibold text-slate-800 focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-shadow">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Address (optional)</label>
                        <input type="text" value="${inputs.propertyAddress}" onchange="setInput('propertyAddress', this.value)" placeholder="123 Main St, City, State" class="w-full px-4 py-3 border border-slate-300 rounded-xl text-slate-600 focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-shadow">
                    </div>
                    <div class="grid grid-cols-2 gap-4 pt-4 border-t border-slate-100">
                        <div class="bg-slate-50 rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-slate-800">${calc.totalUnits}</div>
                            <div class="text-sm text-slate-500">Units</div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold text-slate-800">${fmt(calc.totalSqft)}</div>
                            <div class="text-sm text-slate-500">Total SF</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Acquisition & Financing -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-50 px-6 py-4 border-b border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800">üí∞ Acquisition & Financing</h3>
                    <p class="text-sm text-slate-500">Purchase price and loan details</p>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${inputField('Purchase Price', 'purchasePrice', '$')}
                        ${inputField('Closing Costs', 'closingCosts', '$')}
                        ${inputField('Down Payment', 'downPaymentPct', '', '%')}
                        ${inputField('Interest Rate', 'interestRate', '', '%')}
                    </div>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 pt-4 border-t border-slate-100">
                        <div class="bg-sage-50 rounded-xl p-3 text-center">
                            <div class="text-lg font-bold text-sage-700">$${fmt(calc.loanAmount)}</div>
                            <div class="text-xs text-sage-600">Loan Amount</div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 text-center">
                            <div class="text-lg font-bold text-slate-700">$${fmt(calc.monthlyMortgage)}</div>
                            <div class="text-xs text-slate-500">Monthly P&I</div>
                        </div>
                        <div class="bg-warm-50 rounded-xl p-3 text-center">
                            <div class="text-lg font-bold text-warm-700">$${fmt(calc.totalCashRequired)}</div>
                            <div class="text-xs text-warm-600">Cash Required</div>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 text-center">
                            <div class="text-lg font-bold text-slate-700">${fmtDec(calc.ltv, 0)}%</div>
                            <div class="text-xs text-slate-500">LTV Ratio</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- RENT ROLL -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-slate-800">üè† Rent Roll</h3>
                    <p class="text-sm text-slate-500">Add all units with their monthly rents</p>
                </div>
                <button onclick="addUnit()" class="px-4 py-2 bg-sage-500 hover:bg-sage-600 text-white text-sm font-medium rounded-lg transition-colors shadow-sm">+ Add Unit</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-slate-700">Unit</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-slate-700">Tenant (optional)</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-slate-700">Sq Ft</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-slate-700">Rent/Month</th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-slate-700">$/SF</th>
                            <th class="px-4 py-4 w-12"></th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        ${inputs.units.map(unit => unitRow(unit)).join('')}
                    </tbody>
                    <tfoot class="bg-sage-50 border-t-2 border-sage-200">
                        <tr>
                            <td class="px-6 py-4 font-bold text-sage-700">TOTAL</td>
                            <td class="px-6 py-4 text-slate-500 text-sm">${inputs.units.filter(u => (u.tenant || '').toLowerCase() === 'vacant').length} vacant</td>
                            <td class="px-6 py-4 text-right font-bold text-slate-800">${fmt(calc.totalSqft)} SF</td>
                            <td class="px-6 py-4 text-right font-bold text-sage-700">$${fmt(calc.monthlyRent)}/mo</td>
                            <td class="px-6 py-4 text-right text-slate-600">$${fmtDec(calc.totalSqft > 0 ? calc.monthlyRent / calc.totalSqft : 0)}</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- OPERATING EXPENSES -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-200">
                <h3 class="text-lg font-semibold text-slate-800">üìä Operating Statement</h3>
                <p class="text-sm text-slate-500">Annual income and expenses</p>
            </div>
            <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Income -->
                <div>
                    <h4 class="text-sm font-bold text-sage-600 uppercase tracking-wide mb-4">Income</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-3 px-4 bg-sage-50 rounded-xl">
                            <span class="font-medium text-slate-700">Scheduled Rent</span>
                            <span class="font-bold text-sage-700">$${fmt(calc.annualRent)}/yr</span>
                        </div>
                        ${expenseRow('Other Income', 'otherIncome', '/mo')}
                        ${expenseRow('Vacancy Rate', 'vacancyPct', '%', true)}
                        <div class="flex justify-between items-center py-3 px-4 bg-sage-100 rounded-xl border border-sage-200">
                            <span class="font-bold text-sage-800">Effective Gross Income</span>
                            <span class="font-bold text-sage-800 text-lg">$${fmt(calc.year1EGI)}</span>
                        </div>
                    </div>
                </div>
                <!-- Expenses -->
                <div>
                    <h4 class="text-sm font-bold text-warm-600 uppercase tracking-wide mb-4">Operating Expenses</h4>
                    <div class="grid grid-cols-2 gap-2">
                        ${expenseRow('Property Taxes', 'realEstateTaxes')}
                        ${expenseRow('Insurance', 'insurance')}
                        ${expenseRow('Water/Sewer', 'water')}
                        ${expenseRow('Trash', 'trash')}
                        ${expenseRow('Repairs', 'repairsMaintenance')}
                        ${expenseRow('Management', 'managementPct', '%')}
                        ${expenseRow('Reserves', 'replacementReserves')}
                        ${expenseRow('Other', 'miscellaneous')}
                    </div>
                    <div class="flex justify-between items-center py-3 px-4 bg-warm-100 rounded-xl border border-warm-200 mt-3">
                        <span class="font-bold text-warm-800">Total Expenses</span>
                        <span class="font-bold text-warm-800 text-lg">$${fmt(calc.year1TotalExpenses)}</span>
                    </div>
                </div>
            </div>
            <!-- Results -->
            <div class="px-6 pb-6 grid grid-cols-2 lg:grid-cols-4 gap-4 border-t border-slate-100 pt-6">
                ${resultCard('NOI', `$${fmt(calc.year1NOI)}`, 'Net Operating Income')}
                ${resultCard('Debt Service', `$${fmt(calc.annualDebtService)}`, 'Annual loan payments')}
                ${resultCard('Cash Flow', `$${fmt(calc.year1CashFlow)}`, 'Annual cash remaining', calc.year1CashFlow > 0, calc.year1CashFlow < 0)}
                ${resultCard('Cash-on-Cash', `${fmtDec(calc.cashOnCash, 1)}%`, 'Return on cash invested', calc.cashOnCash >= 8, calc.cashOnCash < 0)}
            </div>
        </section>

        <!-- PROJECTIONS -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-slate-800">üìà ${inputs.projectionYears + 1}-Year Projection</h3>
                    <p class="text-sm text-slate-500">See how your investment grows over time</p>
                </div>
                <div class="flex items-center gap-4 text-sm">
                    <label class="flex items-center gap-2">
                        <span class="text-slate-600">Rent Growth:</span>
                        <input type="number" value="${inputs.annualRentIncrease}" onchange="setNumInput('annualRentIncrease', this.value)" class="w-16 px-2 py-1 border border-slate-300 rounded-lg text-center" step="0.5">
                        <span class="text-slate-500">%/yr</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <span class="text-slate-600">Years:</span>
                        <input type="number" value="${inputs.projectionYears}" onchange="setNumInput('projectionYears', this.value)" class="w-14 px-2 py-1 border border-slate-300 rounded-lg text-center">
                    </label>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-4 text-left font-semibold text-slate-700 sticky-col bg-slate-50 min-w-[180px]">Year</th>
                            ${calc.years.map(y => `<th class="px-4 py-4 text-right font-semibold text-slate-700 min-w-[100px]">${y.year}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-slate-100 bg-white">
                            <td class="px-6 py-3 font-medium text-slate-700 sticky-col bg-white">Gross Income</td>
                            ${calc.years.map(y => `<td class="px-4 py-3 text-right text-slate-600">$${fmt(y.gpi)}</td>`).join('')}
                        </tr>
                        <tr class="border-b border-slate-100 bg-slate-50/50">
                            <td class="px-6 py-3 font-medium text-slate-700 sticky-col bg-slate-50/50">Operating Expenses</td>
                            ${calc.years.map(y => `<td class="px-4 py-3 text-right text-warm-600">($${fmt(y.totalOpex)})</td>`).join('')}
                        </tr>
                        <tr class="border-b border-slate-200 bg-sage-50">
                            <td class="px-6 py-3 font-bold text-sage-700 sticky-col bg-sage-50">Net Operating Income</td>
                            ${calc.years.map(y => `<td class="px-4 py-3 text-right font-bold text-sage-700">$${fmt(y.noi)}</td>`).join('')}
                        </tr>
                        <tr class="border-b border-slate-100 bg-white">
                            <td class="px-6 py-3 font-medium text-slate-700 sticky-col bg-white">Debt Service</td>
                            ${calc.years.map(y => `<td class="px-4 py-3 text-right text-slate-500">($${fmt(y.cashFlow < y.noi ? calc.annualDebtService : 0)})</td>`).join('')}
                        </tr>
                        <tr class="bg-slate-100 border-t-2 border-slate-300">
                            <td class="px-6 py-4 font-bold text-slate-800 sticky-col bg-slate-100">Cash Flow</td>
                            ${calc.years.map(y => {
                                const isNeg = y.cashFlow < 0;
                                return `<td class="px-4 py-4 text-right font-bold ${isNeg ? 'text-red-500' : 'text-sage-700'}">$${fmt(y.cashFlow)}</td>`;
                            }).join('')}
                        </tr>
                        <tr class="bg-white">
                            <td class="px-6 py-3 text-slate-600 sticky-col bg-white">Cash-on-Cash Return</td>
                            ${calc.years.map(y => {
                                const coc = calc.totalCashRequired > 0 ? (y.cashFlow / calc.totalCashRequired) * 100 : 0;
                                const isNeg = coc < 0;
                                return `<td class="px-4 py-3 text-right ${isNeg ? 'text-red-500' : coc >= 8 ? 'text-sage-600 font-semibold' : 'text-slate-600'}">${fmtDec(coc, 1)}%</td>`;
                            }).join('')}
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        `;
    }

    // ============================================================================
    // TEMPLATE HELPERS
    // ============================================================================

    function summaryMetric(label, value, tooltip, isWarning = false) {
        const valueClass = isWarning ? 'text-red-500' : 'text-slate-800';
        return `<div class="help-tip bg-slate-50 rounded-xl p-4 text-center"><div class="text-2xl font-bold ${valueClass}">${value}</div><div class="text-sm text-slate-500">${label}</div><div class="help-content">${tooltip}</div></div>`;
    }

    function inputField(label, key, prefix = '', suffix = '') {
        return `<div><label class="block text-sm font-medium text-slate-600 mb-1">${label}</label><div class="flex items-center border border-slate-300 rounded-xl overflow-hidden focus-within:ring-2 focus-within:ring-sage-500 focus-within:border-sage-500 bg-white">${prefix ? `<span class="pl-4 text-slate-400">${prefix}</span>` : ''}<input type="number" value="${inputs[key]}" onchange="setNumInput('${key}', this.value)" class="w-full px-3 py-3 text-right text-slate-800 font-medium focus:outline-none">${suffix ? `<span class="pr-4 text-slate-400">${suffix}</span>` : ''}</div></div>`;
    }

    function expenseRow(label, key, suffix = '', isHighlight = false) {
        const bgClass = isHighlight ? 'bg-warm-50 border border-warm-200' : 'bg-slate-50';
        const isPercent = suffix === '%';
        const prefix = isPercent ? '' : '$';
        return `<div class="flex items-center justify-between py-2 px-3 rounded-lg ${bgClass}"><span class="text-sm text-slate-600">${label}</span><div class="flex items-center gap-1">${prefix ? `<span class="text-slate-400 text-sm">${prefix}</span>` : ''}<input type="number" value="${inputs[key]}" onchange="setNumInput('${key}', this.value)" class="w-20 px-2 py-1 border border-slate-300 rounded-lg text-right text-sm focus:ring-1 focus:ring-sage-500 focus:border-sage-500">${suffix ? `<span class="text-slate-400 text-sm">${suffix}</span>` : ''}</div></div>`;
    }

    function resultCard(label, value, tooltip, positive = false, negative = false) {
        const bgClass = negative ? 'bg-red-50 border-red-200' : positive ? 'bg-sage-50 border-sage-200' : 'bg-slate-50 border-slate-200';
        const textClass = negative ? 'text-red-600' : positive ? 'text-sage-700' : 'text-slate-800';
        return `<div class="help-tip p-4 rounded-xl border ${bgClass} text-center"><div class="text-xl font-bold ${textClass}">${value}</div><div class="text-sm text-slate-500">${label}</div><div class="help-content">${tooltip}</div></div>`;
    }

    function unitRow(unit) {
        const isVacant = (unit.tenant || '').toLowerCase() === 'vacant';
        const tenantClass = isVacant ? 'bg-warm-50 border-warm-300 text-warm-700' : 'border-slate-300 text-slate-600';
        return `<tr class="hover:bg-slate-50 transition-colors"><td class="px-6 py-4"><input type="text" value="${unit.unitNumber}" onchange="updateUnit('${unit.id}', 'unitNumber', this.value)" class="w-24 px-3 py-2 border border-slate-300 rounded-lg text-sm font-medium focus:ring-1 focus:ring-sage-500 focus:border-sage-500"></td><td class="px-6 py-4"><input type="text" value="${unit.tenant || ''}" onchange="updateUnit('${unit.id}', 'tenant', this.value)" placeholder="Occupied" class="w-32 px-3 py-2 border rounded-lg text-sm focus:ring-1 focus:ring-sage-500 focus:border-sage-500 ${tenantClass}"></td><td class="px-6 py-4 text-right"><input type="number" value="${unit.sqft}" onchange="updateUnit('${unit.id}', 'sqft', this.value)" class="w-20 px-3 py-2 border border-slate-300 rounded-lg text-sm text-right focus:ring-1 focus:ring-sage-500 focus:border-sage-500"></td><td class="px-6 py-4 text-right"><div class="inline-flex items-center border border-slate-300 rounded-lg overflow-hidden focus-within:ring-1 focus-within:ring-sage-500"><span class="pl-3 text-slate-400">$</span><input type="number" value="${unit.rent}" onchange="updateUnit('${unit.id}', 'rent', this.value)" class="w-20 px-2 py-2 text-sm text-right focus:outline-none"></div></td><td class="px-6 py-4 text-right text-slate-500">$${fmtDec(unit.sqft > 0 ? unit.rent / unit.sqft : 0)}</td><td class="px-4 py-4">${inputs.units.length > 1 ? `<button onclick="removeUnit('${unit.id}')" class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">√ó</button>` : ''}</td></tr>`;
    }

    // Initialize
    render();
    </script>
</body>
</html>
