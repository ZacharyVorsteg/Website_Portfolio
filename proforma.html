<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor Pro Forma | Zachary Vorsteg</title>
    <meta name="description" content="Free real estate investment pro forma analysis tool. Easy-to-use cap rate, cash-on-cash, and projection calculator.">
    <link rel="canonical" href="https://zacharyvorsteg.com/proforma.html">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        sage: { 50: '#F0F5F0', 100: '#E1EBE1', 200: '#C3D7C3', 500: '#5B8A5B', 600: '#4A7A4A', 700: '#3A6A3A' },
                        warm: { 50: '#FDF8F3', 100: '#F9EFE5', 200: '#F0E0CE', 500: '#C4956A', 600: '#A67B4F', 700: '#8B6340' },
                        cream: { 50: '#FEFDFB', 100: '#FDF9F3' }
                    },
                    boxShadow: {
                        'soft': '0 2px 8px rgba(0,0,0,0.06)',
                        'card': '0 4px 20px rgba(0,0,0,0.08)',
                        'input': '0 1px 3px rgba(0,0,0,0.08) inset'
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; background: linear-gradient(180deg, #FEFDFB 0%, #F8FAFC 100%); }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        .input-field { background: #FFFFFF !important; border: 1px solid #E2E8F0; box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: all 0.2s; }
        .input-field:focus { border-color: #5B8A5B; box-shadow: 0 0 0 3px rgba(91,138,91,0.15); outline: none; }
        .sticky-col { position: sticky; left: 0; z-index: 10; }
        @media print { .no-print { display: none !important; } body { background: white; } }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #F1F5F9; }
        .kpi-card { background: linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%); }
    </style>
</head>
<body class="min-h-screen text-slate-700">
    <!-- HEADER -->
    <header class="bg-white/90 backdrop-blur-sm border-b border-slate-200 px-6 py-4 sticky top-0 z-50 no-print shadow-soft">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                    <div class="w-10 h-10 bg-gradient-to-br from-sage-500 to-sage-600 rounded-xl flex items-center justify-center shadow-md">
                        <span class="text-white font-bold text-sm">IP</span>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-slate-800">Investor Pro Forma</h1>
                        <p class="text-xs text-slate-500">Free Investment Analysis Tool</p>
                    </div>
                </a>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="exportData()" class="px-4 py-2 text-sm font-medium text-sage-700 bg-sage-50 hover:bg-sage-100 rounded-lg transition-colors flex items-center gap-2" title="Export to share">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                    Export
                </button>
                <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors flex items-center gap-2" title="Import shared file">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Import
                </button>
                <input type="file" id="importFile" accept=".json" onchange="importData(event)" class="hidden">
                <button onclick="resetAll()" class="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-lg transition-colors">Reset</button>
                <button onclick="window.print()" class="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 rounded-lg transition-colors">Print</button>
                <a href="/" class="px-4 py-2 text-sm font-medium text-white bg-sage-600 hover:bg-sage-700 rounded-lg transition-colors shadow-sm">‚Üê Back</a>
            </div>
        </div>
    </header>

    <!-- HOW TO USE -->
    <div class="bg-gradient-to-r from-sage-50 to-cream-100 border-b border-sage-100 px-6 py-5 no-print">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-sage-500 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm">
                    <span class="text-white text-lg">?</span>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-slate-800 mb-2">How to Use This Tool</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-slate-600">
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">1</span>
                            <span><strong>Property</strong> ‚Äî Enter purchase price & financing</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">2</span>
                            <span><strong>Rent Roll</strong> ‚Äî Add units with rents</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">3</span>
                            <span><strong>Expenses</strong> ‚Äî Input operating costs</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="w-6 h-6 bg-white rounded-full flex items-center justify-center text-sage-600 font-bold text-xs shadow-sm flex-shrink-0">4</span>
                            <span><strong>Analysis</strong> ‚Äî Review grade & KPIs</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main id="app" class="max-w-7xl mx-auto px-6 py-8">
        <div class="text-center py-20"><div class="text-sage-500 text-xl">Loading...</div></div>
    </main>

    <footer class="bg-white border-t border-slate-200 py-6 mt-12 no-print">
        <div class="max-w-7xl mx-auto px-6 text-center text-sm text-slate-500">
            <p>Free tool by <a href="/" class="text-sage-600 hover:underline font-medium">Zachary Vorsteg</a> ‚Ä¢ <a href="/#book-discovery" class="text-sage-600 hover:underline">Questions?</a></p>
        </div>
    </footer>

    <script>
    // ============================================================================
    // STATE
    // ============================================================================
    
    const defaultUnits = [];
    for (let i = 1; i <= 4; i++) {
        defaultUnits.push({ id: String(i), unitNumber: `Unit ${i}`, tenant: '', sqft: 800, rent: 1500 });
    }

    const defaultInputs = {
        propertyName: 'My Investment Property',
        propertyAddress: '',
        purchasePrice: 500000,
        closingCosts: 10000,
        immediateRepairs: 0,
        downPaymentPct: 25,
        interestRate: 7.0,
        loanTermYears: 30,
        units: JSON.parse(JSON.stringify(defaultUnits)),
        laundryIncome: 0,
        parkingIncome: 0,
        otherIncome: 0,
        realEstateTaxes: 6000,
        insurance: 2400,
        water: 1200,
        sewer: 600,
        gas: 0,
        electric: 0,
        trash: 600,
        landscaping: 600,
        snowRemoval: 0,
        repairsMaintenance: 2000,
        pestControl: 300,
        managementPct: 8,
        legalAccounting: 500,
        advertising: 200,
        miscellaneous: 500,
        replacementReserves: 1200,
        vacancyPct: 5,
        annualRentIncrease: 3,
        annualExpenseIncrease: 2,
        projectionYears: 5,
        exitCapRate: 6,
    };

    let inputs = JSON.parse(localStorage.getItem('proforma-v2') || 'null') || JSON.parse(JSON.stringify(defaultInputs));

    // ============================================================================
    // HELPERS
    // ============================================================================

    const fmt = n => isNaN(n) || !isFinite(n) ? '0' : Math.round(n).toLocaleString('en-US');
    const fmtDec = (n, dec = 2) => isNaN(n) || !isFinite(n) ? '0.00' : n.toLocaleString('en-US', { minimumFractionDigits: dec, maximumFractionDigits: dec });

    function save() { localStorage.setItem('proforma-v2', JSON.stringify(inputs)); render(); }
    function resetAll() { if (confirm('Reset all values to defaults?')) { inputs = JSON.parse(JSON.stringify(defaultInputs)); save(); } }
    function setInput(key, value) { inputs[key] = value; save(); }
    function setNumInput(key, value) { inputs[key] = parseFloat(value) || 0; save(); }
    function updateUnit(id, field, value) {
        const unit = inputs.units.find(u => u.id === id);
        if (unit) { unit[field] = (field === 'unitNumber' || field === 'tenant') ? value : (parseFloat(value) || 0); save(); }
    }
    function addUnit() { inputs.units.push({ id: String(Date.now()), unitNumber: `Unit ${inputs.units.length + 1}`, tenant: '', sqft: 800, rent: 1500 }); save(); }
    function removeUnit(id) { if (inputs.units.length > 1) { inputs.units = inputs.units.filter(u => u.id !== id); save(); } }

    // Export/Import
    function exportData() {
        const data = { version: '2.0', exported: new Date().toISOString(), propertyName: inputs.propertyName, data: inputs };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `proforma-${inputs.propertyName.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (imported.data) {
                    inputs = { ...defaultInputs, ...imported.data };
                    save();
                    alert('Pro Forma imported successfully!');
                } else {
                    alert('Invalid file format.');
                }
            } catch (err) {
                alert('Error reading file: ' + err.message);
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    // ============================================================================
    // CALCULATIONS
    // ============================================================================

    function calculate() {
        const { purchasePrice, closingCosts, immediateRepairs, downPaymentPct, interestRate, loanTermYears, units,
            laundryIncome, parkingIncome, otherIncome, realEstateTaxes, insurance, water, sewer, gas, electric, trash,
            landscaping, snowRemoval, repairsMaintenance, pestControl, managementPct, legalAccounting, advertising, miscellaneous, replacementReserves,
            vacancyPct, annualRentIncrease, annualExpenseIncrease, projectionYears } = inputs;

        const totalUnits = units.length;
        const totalSqft = units.reduce((sum, u) => sum + u.sqft, 0);
        const monthlyRent = units.reduce((sum, u) => sum + u.rent, 0);
        const annualRent = monthlyRent * 12;
        const pricePerSqft = totalSqft > 0 ? purchasePrice / totalSqft : 0;
        const pricePerUnit = totalUnits > 0 ? purchasePrice / totalUnits : 0;
        const monthlyOtherIncome = laundryIncome + parkingIncome + otherIncome;
        const grossPotentialIncome = annualRent + (monthlyOtherIncome * 12);
        const downPayment = purchasePrice * (downPaymentPct / 100);
        const loanAmount = purchasePrice - downPayment;
        const ltv = purchasePrice > 0 ? (loanAmount / purchasePrice) * 100 : 0;
        const monthlyRate = interestRate / 100 / 12;
        const numPayments = loanTermYears * 12;
        const monthlyMortgage = loanAmount > 0 && monthlyRate > 0 ? loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1) : 0;
        const annualDebtService = monthlyMortgage * 12;
        const totalCashRequired = downPayment + closingCosts + immediateRepairs;
        const year1Vacancy = grossPotentialIncome * (vacancyPct / 100);
        const year1EGI = grossPotentialIncome - year1Vacancy;
        const year1Management = year1EGI * (managementPct / 100);
        const utilities = water + sewer + gas + electric;
        const baseExpenses = realEstateTaxes + insurance + utilities + trash + landscaping + snowRemoval + repairsMaintenance + pestControl + legalAccounting + advertising + miscellaneous + replacementReserves;
        const year1TotalExpenses = baseExpenses + year1Management;
        const year1NOI = year1EGI - year1TotalExpenses;
        const year1CashFlow = year1NOI - annualDebtService;
        const capRate = purchasePrice > 0 ? (year1NOI / purchasePrice) * 100 : 0;
        const cashOnCash = totalCashRequired > 0 ? (year1CashFlow / totalCashRequired) * 100 : 0;
        const grossRentMultiplier = annualRent > 0 ? purchasePrice / annualRent : 0;
        const dscr = annualDebtService > 0 ? year1NOI / annualDebtService : 999;
        const expenseRatio = year1EGI > 0 ? (year1TotalExpenses / year1EGI) * 100 : 0;
        const rentPerSF = totalSqft > 0 ? monthlyRent / totalSqft : 0;
        const expensePerUnit = totalUnits > 0 ? year1TotalExpenses / totalUnits : 0;
        const effectiveTaxRate = purchasePrice > 0 ? (realEstateTaxes / purchasePrice) * 100 : 0;

        // Breakeven calculations
        const isCashDeal = downPaymentPct >= 100 || loanAmount <= 0;
        const totalObligations = year1TotalExpenses + annualDebtService;
        const occupancyBE = grossPotentialIncome > 0 ? Math.min(100, (totalObligations / grossPotentialIncome) * 100) : 100;
        const rentBE = totalUnits > 0 ? (totalObligations / totalUnits / 12) / (1 - vacancyPct/100 - managementPct/100) : 0;
        let rateBE = null;
        if (!isCashDeal && year1NOI > 0) {
            for (let r = 1; r <= 15; r += 0.25) {
                const mr = r / 100 / 12, np = loanTermYears * 12;
                const pmt = loanAmount * (mr * Math.pow(1 + mr, np)) / (Math.pow(1 + mr, np) - 1);
                if (pmt * 12 >= year1NOI) { rateBE = r; break; }
            }
        }

        const years = [];
        const currentYear = new Date().getFullYear();
        for (let i = 0; i <= projectionYears; i++) {
            const rentGrowth = Math.pow(1 + annualRentIncrease / 100, i);
            const expenseGrowth = Math.pow(1 + annualExpenseIncrease / 100, i);
            const gpi = grossPotentialIncome * rentGrowth;
            const vacancy = gpi * (vacancyPct / 100);
            const egi = gpi - vacancy;
            const totalOpex = (baseExpenses * expenseGrowth) + (egi * managementPct / 100);
            const noi = egi - totalOpex;
            const cashFlow = noi - annualDebtService;
            years.push({ year: currentYear + i, gpi, vacancy, egi, totalOpex, noi, cashFlow });
        }

        return { totalUnits, totalSqft, monthlyRent, annualRent, pricePerSqft, pricePerUnit, grossPotentialIncome, downPayment, loanAmount, ltv, monthlyMortgage, annualDebtService, totalCashRequired, year1EGI, year1TotalExpenses, year1NOI, year1CashFlow, years, capRate, cashOnCash, grossRentMultiplier, dscr, expenseRatio, rentPerSF, expensePerUnit, effectiveTaxRate, isCashDeal, occupancyBE, rentBE, rateBE, utilities };
    }

    function getGradeAndInsights(calc) {
        const { capRate, cashOnCash, dscr, expenseRatio, isCashDeal, occupancyBE, rentBE, rateBE, pricePerSqft, pricePerUnit, grossRentMultiplier, expensePerUnit, rentPerSF, effectiveTaxRate } = calc;
        const { interestRate, vacancyPct } = inputs;
        
        let score = 50;
        if (cashOnCash >= 10) score += 20; else if (cashOnCash >= 6) score += 12; else if (cashOnCash >= 0) score += 4; else score -= 15;
        if (isCashDeal) score += 8; else if (dscr >= 1.3) score += 12; else if (dscr >= 1.15) score += 6; else if (dscr < 1) score -= 15;
        if (capRate >= 7) score += 10; else if (capRate >= 5.5) score += 5; else if (capRate < 4.5) score -= 5;
        if (expenseRatio <= 42) score += 6; else if (expenseRatio > 52) score -= 6;
        score = Math.max(0, Math.min(100, score));
        const grade = score >= 80 ? 'A' : score >= 68 ? 'B' : score >= 55 ? 'C' : score >= 40 ? 'D' : 'F';

        // KPIs
        const kpis = [
            { label: 'Price/SF', value: `$${fmtDec(pricePerSqft, 0)}`, status: pricePerSqft > 350 ? 'warning' : pricePerSqft < 180 ? 'good' : 'neutral' },
            { label: 'Price/Unit', value: `$${fmt(pricePerUnit)}`, status: pricePerUnit > 200000 ? 'warning' : pricePerUnit < 120000 ? 'good' : 'neutral' },
            { label: 'GRM', value: fmtDec(grossRentMultiplier, 1), status: grossRentMultiplier > 12 ? 'warning' : grossRentMultiplier < 9 ? 'good' : 'neutral' },
            { label: 'OpEx/Unit', value: `$${fmt(expensePerUnit)}`, status: expensePerUnit > 7500 ? 'warning' : expensePerUnit < 5000 ? 'good' : 'neutral' },
            { label: 'Rent/SF', value: `$${fmtDec(rentPerSF, 2)}`, status: rentPerSF > 2.5 ? 'good' : rentPerSF < 1.5 ? 'warning' : 'neutral' },
            { label: 'Tax Rate', value: `${fmtDec(effectiveTaxRate, 2)}%`, status: effectiveTaxRate > 2.5 ? 'bad' : 'neutral' },
        ];

        // Insights
        const insights = [];
        if (isCashDeal) {
            insights.push({ type: 'info', text: `All-Cash Deal: ${fmtDec(capRate)}% unleveraged cap rate` });
        } else {
            const spread = capRate - interestRate;
            if (spread < 0) {
                insights.push({ type: 'warning', text: `Negative leverage: Cap rate (${fmtDec(capRate)}%) below debt cost (${interestRate}%)` });
            } else if (spread > 1.5) {
                insights.push({ type: 'good', text: `Positive leverage: +${fmtDec(spread * 100, 0)} bps spread over debt cost` });
            }
        }
        if (occupancyBE > 95) {
            insights.push({ type: 'warning', text: `High breakeven occupancy: ${fmtDec(occupancyBE, 0)}% needed` });
        }
        if (expenseRatio > 50) {
            insights.push({ type: 'warning', text: `High expense ratio: ${fmtDec(expenseRatio, 0)}% of income to expenses` });
        }
        if (dscr >= 1 && dscr < 1.25) {
            insights.push({ type: 'warning', text: `Thin debt coverage: DSCR of ${fmtDec(dscr, 2)}x is below lender preference` });
        }

        return { score, grade, kpis, insights, breakeven: { occupancy: occupancyBE, rent: rentBE, rate: rateBE } };
    }

    // ============================================================================
    // RENDER
    // ============================================================================

    function render() {
        const calc = calculate();
        const { score, grade, kpis, insights, breakeven } = getGradeAndInsights(calc);
        const gradeColors = { A: 'from-sage-500 to-sage-600', B: 'from-blue-500 to-blue-600', C: 'from-amber-500 to-amber-600', D: 'from-orange-500 to-orange-600', F: 'from-red-400 to-red-500' };

        document.getElementById('app').innerHTML = `
        <!-- INVESTMENT GRADE & METRICS -->
        <section class="card p-6 mb-6">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Grade -->
                <div class="flex items-center gap-5">
                    <div class="w-24 h-24 bg-gradient-to-br ${gradeColors[grade]} rounded-2xl flex items-center justify-center shadow-lg">
                        <span class="text-5xl font-bold text-white">${grade}</span>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Investment Grade</h2>
                        <p class="text-slate-500 mb-2">Score: ${score}/100</p>
                        <span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${grade === 'A' || grade === 'B' ? 'bg-sage-100 text-sage-700' : grade === 'C' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'}">
                            ${grade === 'A' ? 'Excellent Investment' : grade === 'B' ? 'Strong Potential' : grade === 'C' ? 'Moderate Risk' : 'Needs Improvement'}
                        </span>
                    </div>
                </div>
                
                <!-- Key Metrics -->
                <div class="flex-1 grid grid-cols-2 lg:grid-cols-4 gap-3">
                    <div class="kpi-card rounded-xl p-4 border border-slate-200 shadow-soft text-center">
                        <div class="text-2xl font-bold text-slate-800">${fmtDec(calc.capRate, 1)}%</div>
                        <div class="text-sm text-slate-500">Cap Rate</div>
                    </div>
                    <div class="kpi-card rounded-xl p-4 border border-slate-200 shadow-soft text-center">
                        <div class="text-2xl font-bold ${calc.cashOnCash < 0 ? 'text-red-500' : calc.cashOnCash >= 8 ? 'text-sage-600' : 'text-slate-800'}">${fmtDec(calc.cashOnCash, 1)}%</div>
                        <div class="text-sm text-slate-500">Cash-on-Cash</div>
                    </div>
                    <div class="kpi-card rounded-xl p-4 border border-slate-200 shadow-soft text-center">
                        <div class="text-2xl font-bold ${calc.dscr < 1 ? 'text-red-500' : calc.dscr >= 1.25 ? 'text-sage-600' : 'text-amber-600'}">${fmtDec(calc.dscr, 2)}x</div>
                        <div class="text-sm text-slate-500">DSCR</div>
                    </div>
                    <div class="kpi-card rounded-xl p-4 border border-slate-200 shadow-soft text-center">
                        <div class="text-2xl font-bold ${calc.year1CashFlow < 0 ? 'text-red-500' : 'text-sage-600'}">$${fmt(calc.year1CashFlow)}</div>
                        <div class="text-sm text-slate-500">Cash Flow</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- KPIs & ANALYSIS -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- KPI Grid -->
            <div class="card p-5">
                <h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide mb-4">Key Performance Indicators</h3>
                <div class="grid grid-cols-2 gap-3">
                    ${kpis.map(k => `
                        <div class="p-3 rounded-lg ${k.status === 'good' ? 'bg-sage-50 border border-sage-200' : k.status === 'warning' ? 'bg-amber-50 border border-amber-200' : k.status === 'bad' ? 'bg-red-50 border border-red-200' : 'bg-slate-50 border border-slate-200'}">
                            <div class="text-lg font-bold ${k.status === 'good' ? 'text-sage-700' : k.status === 'warning' ? 'text-amber-700' : k.status === 'bad' ? 'text-red-600' : 'text-slate-700'}">${k.value}</div>
                            <div class="text-xs text-slate-500">${k.label}</div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <!-- Breakeven Analysis -->
            <div class="card p-5">
                <h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide mb-4">Breakeven Analysis</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center pb-3 border-b border-slate-100">
                        <div>
                            <div class="font-medium text-slate-700">Occupancy</div>
                            <div class="text-xs text-slate-500">Current: ${100 - inputs.vacancyPct}%</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-bold ${breakeven.occupancy > 95 ? 'text-red-500' : breakeven.occupancy > 85 ? 'text-amber-600' : 'text-slate-700'}">${fmtDec(breakeven.occupancy, 0)}%</span>
                            ${breakeven.occupancy < 100 - inputs.vacancyPct ? '<span class="text-sage-500">‚úì</span>' : '<span class="text-red-500">‚úó</span>'}
                        </div>
                    </div>
                    <div class="flex justify-between items-center pb-3 border-b border-slate-100">
                        <div>
                            <div class="font-medium text-slate-700">Rent/Unit</div>
                            <div class="text-xs text-slate-500">Current: $${fmt(calc.monthlyRent / calc.totalUnits)}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-bold text-slate-700">$${fmt(breakeven.rent)}</span>
                            ${breakeven.rent < calc.monthlyRent / calc.totalUnits ? '<span class="text-sage-500">‚úì</span>' : '<span class="text-red-500">‚úó</span>'}
                        </div>
                    </div>
                    ${breakeven.rate ? `
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-slate-700">Interest Rate</div>
                            <div class="text-xs text-slate-500">Current: ${inputs.interestRate}%</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-bold ${breakeven.rate <= inputs.interestRate ? 'text-red-500' : 'text-slate-700'}">${fmtDec(breakeven.rate, 1)}%</span>
                            ${breakeven.rate > inputs.interestRate ? '<span class="text-sage-500">‚úì</span>' : '<span class="text-red-500">‚úó</span>'}
                        </div>
                    </div>` : ''}
                </div>
            </div>

            <!-- Insights -->
            <div class="card p-5">
                <h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide mb-4">Strategic Insights</h3>
                <div class="space-y-3">
                    ${insights.length > 0 ? insights.map(i => `
                        <div class="flex items-start gap-3 p-3 rounded-lg ${i.type === 'good' ? 'bg-sage-50' : i.type === 'warning' ? 'bg-amber-50' : 'bg-blue-50'}">
                            <span class="text-lg">${i.type === 'good' ? '‚úì' : i.type === 'warning' ? '‚ö†' : '‚Ñπ'}</span>
                            <span class="text-sm ${i.type === 'good' ? 'text-sage-700' : i.type === 'warning' ? 'text-amber-700' : 'text-blue-700'}">${i.text}</span>
                        </div>
                    `).join('') : '<div class="text-slate-500 text-sm">No significant issues detected.</div>'}
                </div>
            </div>
        </div>

        <!-- PROPERTY & FINANCING -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="card overflow-hidden">
                <div class="bg-slate-50 px-5 py-4 border-b border-slate-200">
                    <h3 class="font-semibold text-slate-800">üìç Property Details</h3>
                </div>
                <div class="p-5 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Property Name</label>
                        <input type="text" value="${inputs.propertyName}" onchange="setInput('propertyName', this.value)" class="input-field w-full px-4 py-3 rounded-lg text-lg font-semibold text-slate-800">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Address</label>
                        <input type="text" value="${inputs.propertyAddress}" onchange="setInput('propertyAddress', this.value)" placeholder="Enter address..." class="input-field w-full px-4 py-3 rounded-lg text-slate-600">
                    </div>
                    <div class="grid grid-cols-4 gap-3 pt-3 border-t border-slate-100">
                        <div class="text-center p-3 bg-slate-50 rounded-lg"><div class="text-xl font-bold text-slate-800">${calc.totalUnits}</div><div class="text-xs text-slate-500">Units</div></div>
                        <div class="text-center p-3 bg-slate-50 rounded-lg"><div class="text-xl font-bold text-slate-800">${fmt(calc.totalSqft)}</div><div class="text-xs text-slate-500">Sq Ft</div></div>
                        <div class="text-center p-3 bg-slate-50 rounded-lg"><div class="text-xl font-bold text-slate-800">$${fmt(calc.pricePerUnit)}</div><div class="text-xs text-slate-500">$/Unit</div></div>
                        <div class="text-center p-3 bg-slate-50 rounded-lg"><div class="text-xl font-bold text-slate-800">$${fmtDec(calc.pricePerSqft, 0)}</div><div class="text-xs text-slate-500">$/SF</div></div>
                    </div>
                </div>
            </div>

            <div class="card overflow-hidden">
                <div class="bg-slate-50 px-5 py-4 border-b border-slate-200">
                    <h3 class="font-semibold text-slate-800">üí∞ Acquisition & Financing</h3>
                </div>
                <div class="p-5">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${inputField('Purchase Price', 'purchasePrice', '$')}
                        ${inputField('Closing Costs', 'closingCosts', '$')}
                        ${inputField('Down Payment', 'downPaymentPct', '', '%')}
                        ${inputField('Interest Rate', 'interestRate', '', '%')}
                    </div>
                    <div class="grid grid-cols-4 gap-3 pt-4 border-t border-slate-100">
                        <div class="text-center p-3 bg-sage-50 rounded-lg border border-sage-100"><div class="text-lg font-bold text-sage-700">$${fmt(calc.loanAmount)}</div><div class="text-xs text-sage-600">Loan</div></div>
                        <div class="text-center p-3 bg-slate-50 rounded-lg"><div class="text-lg font-bold text-slate-700">$${fmt(calc.monthlyMortgage)}</div><div class="text-xs text-slate-500">P&I/Mo</div></div>
                        <div class="text-center p-3 bg-warm-50 rounded-lg border border-warm-100"><div class="text-lg font-bold text-warm-700">$${fmt(calc.totalCashRequired)}</div><div class="text-xs text-warm-600">Cash In</div></div>
                        <div class="text-center p-3 bg-slate-50 rounded-lg"><div class="text-lg font-bold text-slate-700">${fmtDec(calc.ltv, 0)}%</div><div class="text-xs text-slate-500">LTV</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RENT ROLL -->
        <div class="card overflow-hidden mb-6">
            <div class="bg-slate-50 px-5 py-4 border-b border-slate-200 flex items-center justify-between">
                <h3 class="font-semibold text-slate-800">üè† Rent Roll</h3>
                <button onclick="addUnit()" class="px-4 py-2 bg-sage-500 hover:bg-sage-600 text-white text-sm font-medium rounded-lg transition-colors shadow-sm">+ Add Unit</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-5 py-3 text-left text-sm font-semibold text-slate-600">Unit</th>
                            <th class="px-5 py-3 text-left text-sm font-semibold text-slate-600">Tenant</th>
                            <th class="px-5 py-3 text-right text-sm font-semibold text-slate-600">Sq Ft</th>
                            <th class="px-5 py-3 text-right text-sm font-semibold text-slate-600">Rent/Mo</th>
                            <th class="px-5 py-3 text-right text-sm font-semibold text-slate-600">$/SF</th>
                            <th class="px-3 py-3 w-12"></th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        ${inputs.units.map(u => unitRow(u)).join('')}
                    </tbody>
                    <tfoot class="bg-sage-50 border-t-2 border-sage-200">
                        <tr>
                            <td class="px-5 py-4 font-bold text-sage-700">TOTAL</td>
                            <td class="px-5 py-4 text-slate-500 text-sm">${inputs.units.filter(u => (u.tenant || '').toLowerCase() === 'vacant').length} vacant</td>
                            <td class="px-5 py-4 text-right font-bold text-slate-800">${fmt(calc.totalSqft)}</td>
                            <td class="px-5 py-4 text-right font-bold text-sage-700">$${fmt(calc.monthlyRent)}</td>
                            <td class="px-5 py-4 text-right text-slate-600">$${fmtDec(calc.rentPerSF)}</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- OPERATING EXPENSES -->
        <div class="card overflow-hidden mb-6">
            <div class="bg-slate-50 px-5 py-4 border-b border-slate-200">
                <h3 class="font-semibold text-slate-800">üìä Operating Statement</h3>
            </div>
            <div class="p-5 grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h4 class="text-sm font-bold text-sage-600 uppercase tracking-wide mb-3">Income</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between py-2 px-3 bg-slate-50 rounded-lg"><span class="text-slate-600">Scheduled Rent</span><span class="font-semibold text-slate-800">$${fmt(calc.annualRent)}</span></div>
                        ${expenseRow('Other Income', 'otherIncome', '/mo')}
                        ${expenseRow('Vacancy', 'vacancyPct', '%', true)}
                        <div class="flex justify-between py-3 px-3 bg-sage-100 rounded-lg border border-sage-200"><span class="font-bold text-sage-800">Effective Gross Income</span><span class="font-bold text-sage-800 text-lg">$${fmt(calc.year1EGI)}</span></div>
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-bold text-warm-600 uppercase tracking-wide mb-3">Expenses</h4>
                    <div class="grid grid-cols-2 gap-2">
                        ${expenseRow('Taxes', 'realEstateTaxes')}
                        ${expenseRow('Insurance', 'insurance')}
                        ${expenseRow('Utilities', 'water')}
                        ${expenseRow('Trash', 'trash')}
                        ${expenseRow('Repairs', 'repairsMaintenance')}
                        ${expenseRow('Mgmt %', 'managementPct', '%')}
                        ${expenseRow('Reserves', 'replacementReserves')}
                        ${expenseRow('Other', 'miscellaneous')}
                    </div>
                    <div class="flex justify-between py-3 px-3 bg-warm-100 rounded-lg border border-warm-200 mt-3"><span class="font-bold text-warm-800">Total Expenses</span><span class="font-bold text-warm-800">$${fmt(calc.year1TotalExpenses)}</span></div>
                </div>
            </div>
            <div class="px-5 pb-5 grid grid-cols-4 gap-4 border-t border-slate-100 pt-5">
                <div class="text-center p-4 bg-slate-50 rounded-xl"><div class="text-2xl font-bold text-slate-800">$${fmt(calc.year1NOI)}</div><div class="text-sm text-slate-500">NOI</div></div>
                <div class="text-center p-4 bg-slate-50 rounded-xl"><div class="text-2xl font-bold text-slate-700">$${fmt(calc.annualDebtService)}</div><div class="text-sm text-slate-500">Debt Service</div></div>
                <div class="text-center p-4 rounded-xl ${calc.year1CashFlow >= 0 ? 'bg-sage-50 border border-sage-200' : 'bg-red-50 border border-red-200'}"><div class="text-2xl font-bold ${calc.year1CashFlow >= 0 ? 'text-sage-700' : 'text-red-600'}">$${fmt(calc.year1CashFlow)}</div><div class="text-sm ${calc.year1CashFlow >= 0 ? 'text-sage-600' : 'text-red-500'}">Cash Flow</div></div>
                <div class="text-center p-4 rounded-xl ${calc.cashOnCash >= 8 ? 'bg-sage-50 border border-sage-200' : calc.cashOnCash < 0 ? 'bg-red-50 border border-red-200' : 'bg-slate-50'}"><div class="text-2xl font-bold ${calc.cashOnCash >= 8 ? 'text-sage-700' : calc.cashOnCash < 0 ? 'text-red-600' : 'text-slate-700'}">${fmtDec(calc.cashOnCash, 1)}%</div><div class="text-sm text-slate-500">Cash-on-Cash</div></div>
            </div>
        </div>

        <!-- PROJECTION -->
        <div class="card overflow-hidden">
            <div class="bg-slate-50 px-5 py-4 border-b border-slate-200 flex flex-wrap items-center justify-between gap-4">
                <h3 class="font-semibold text-slate-800">üìà ${inputs.projectionYears + 1}-Year Projection</h3>
                <div class="flex items-center gap-4 text-sm">
                    <label class="flex items-center gap-2"><span class="text-slate-600">Growth:</span><input type="number" value="${inputs.annualRentIncrease}" onchange="setNumInput('annualRentIncrease', this.value)" class="input-field w-14 px-2 py-1 rounded text-center" step="0.5">%</label>
                    <label class="flex items-center gap-2"><span class="text-slate-600">Years:</span><input type="number" value="${inputs.projectionYears}" onchange="setNumInput('projectionYears', this.value)" class="input-field w-12 px-2 py-1 rounded text-center"></label>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-slate-50 border-b border-slate-200">
                        <tr>
                            <th class="px-5 py-3 text-left font-semibold text-slate-600 sticky-col bg-slate-50 min-w-[160px]">Year</th>
                            ${calc.years.map(y => `<th class="px-4 py-3 text-right font-semibold text-slate-600 min-w-[100px]">${y.year}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-slate-100 bg-white"><td class="px-5 py-3 font-medium text-slate-700 sticky-col bg-white">Gross Income</td>${calc.years.map(y => `<td class="px-4 py-3 text-right text-slate-600">$${fmt(y.gpi)}</td>`).join('')}</tr>
                        <tr class="border-b border-slate-100 bg-slate-50/50"><td class="px-5 py-3 font-medium text-slate-700 sticky-col bg-slate-50/50">Expenses</td>${calc.years.map(y => `<td class="px-4 py-3 text-right text-warm-600">($${fmt(y.totalOpex)})</td>`).join('')}</tr>
                        <tr class="border-b border-slate-200 bg-sage-50"><td class="px-5 py-3 font-bold text-sage-700 sticky-col bg-sage-50">NOI</td>${calc.years.map(y => `<td class="px-4 py-3 text-right font-bold text-sage-700">$${fmt(y.noi)}</td>`).join('')}</tr>
                        <tr class="border-b border-slate-100 bg-white"><td class="px-5 py-3 text-slate-600 sticky-col bg-white">Debt Service</td>${calc.years.map(() => `<td class="px-4 py-3 text-right text-slate-500">($${fmt(calc.annualDebtService)})</td>`).join('')}</tr>
                        <tr class="bg-slate-100 border-t-2 border-slate-300"><td class="px-5 py-4 font-bold text-slate-800 sticky-col bg-slate-100">Cash Flow</td>${calc.years.map(y => `<td class="px-4 py-4 text-right font-bold ${y.cashFlow < 0 ? 'text-red-500' : 'text-sage-700'}">$${fmt(y.cashFlow)}</td>`).join('')}</tr>
                        <tr class="bg-white"><td class="px-5 py-3 text-slate-600 sticky-col bg-white">Cash-on-Cash</td>${calc.years.map(y => { const c = calc.totalCashRequired > 0 ? (y.cashFlow / calc.totalCashRequired) * 100 : 0; return `<td class="px-4 py-3 text-right ${c < 0 ? 'text-red-500' : c >= 8 ? 'text-sage-600 font-semibold' : 'text-slate-600'}">${fmtDec(c, 1)}%</td>`; }).join('')}</tr>
                    </tbody>
                </table>
            </div>
        </div>
        `;
    }

    // ============================================================================
    // TEMPLATE HELPERS
    // ============================================================================

    function inputField(label, key, prefix = '', suffix = '') {
        return `<div><label class="block text-sm font-medium text-slate-600 mb-1">${label}</label><div class="flex items-center input-field rounded-lg overflow-hidden">${prefix ? `<span class="pl-3 text-slate-400">${prefix}</span>` : ''}<input type="number" value="${inputs[key]}" onchange="setNumInput('${key}', this.value)" class="w-full px-3 py-2.5 text-right text-slate-800 font-medium bg-transparent border-0 focus:outline-none focus:ring-0">${suffix ? `<span class="pr-3 text-slate-400">${suffix}</span>` : ''}</div></div>`;
    }

    function expenseRow(label, key, suffix = '', highlight = false) {
        const isPercent = suffix === '%';
        return `<div class="flex items-center justify-between py-2 px-3 rounded-lg ${highlight ? 'bg-amber-50 border border-amber-100' : 'bg-slate-50'}"><span class="text-sm text-slate-600">${label}</span><div class="flex items-center gap-1">${!isPercent ? '<span class="text-slate-400 text-sm">$</span>' : ''}<input type="number" value="${inputs[key]}" onchange="setNumInput('${key}', this.value)" class="input-field w-20 px-2 py-1.5 rounded text-right text-sm">${suffix ? `<span class="text-slate-400 text-sm">${suffix}</span>` : ''}</div></div>`;
    }

    function unitRow(u) {
        const isVacant = (u.tenant || '').toLowerCase() === 'vacant';
        return `<tr class="hover:bg-slate-50 transition-colors"><td class="px-5 py-3"><input type="text" value="${u.unitNumber}" onchange="updateUnit('${u.id}', 'unitNumber', this.value)" class="input-field w-24 px-3 py-2 rounded-lg text-sm font-medium"></td><td class="px-5 py-3"><input type="text" value="${u.tenant || ''}" onchange="updateUnit('${u.id}', 'tenant', this.value)" placeholder="Occupied" class="input-field w-32 px-3 py-2 rounded-lg text-sm ${isVacant ? '!border-amber-300 !bg-amber-50 text-amber-700' : ''}"></td><td class="px-5 py-3 text-right"><input type="number" value="${u.sqft}" onchange="updateUnit('${u.id}', 'sqft', this.value)" class="input-field w-20 px-3 py-2 rounded-lg text-sm text-right"></td><td class="px-5 py-3 text-right"><div class="inline-flex items-center input-field rounded-lg overflow-hidden"><span class="pl-3 text-slate-400">$</span><input type="number" value="${u.rent}" onchange="updateUnit('${u.id}', 'rent', this.value)" class="w-20 px-2 py-2 text-sm text-right bg-transparent border-0 focus:outline-none focus:ring-0"></div></td><td class="px-5 py-3 text-right text-slate-500">$${fmtDec(u.sqft > 0 ? u.rent / u.sqft : 0)}</td><td class="px-3 py-3">${inputs.units.length > 1 ? `<button onclick="removeUnit('${u.id}')" class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors text-lg">√ó</button>` : ''}</td></tr>`;
    }

    // Initialize
    render();
    </script>
</body>
</html>
